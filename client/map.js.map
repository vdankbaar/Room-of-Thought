{
  "version": 3,
  "sources": ["../node_modules/engine.io-parser/build/esm/commons.js", "../node_modules/engine.io-parser/build/esm/encodePacket.browser.js", "../node_modules/engine.io-parser/build/esm/contrib/base64-arraybuffer.js", "../node_modules/engine.io-parser/build/esm/decodePacket.browser.js", "../node_modules/engine.io-parser/build/esm/index.js", "../node_modules/@socket.io/component-emitter/index.mjs", "../node_modules/engine.io-client/build/esm/globalThis.browser.js", "../node_modules/engine.io-client/build/esm/util.js", "../node_modules/engine.io-client/build/esm/contrib/parseqs.js", "../node_modules/engine.io-client/build/esm/transport.js", "../node_modules/engine.io-client/build/esm/contrib/yeast.js", "../node_modules/engine.io-client/build/esm/contrib/has-cors.js", "../node_modules/engine.io-client/build/esm/transports/xmlhttprequest.browser.js", "../node_modules/engine.io-client/build/esm/transports/polling.js", "../node_modules/engine.io-client/build/esm/transports/websocket-constructor.browser.js", "../node_modules/engine.io-client/build/esm/transports/websocket.js", "../node_modules/engine.io-client/build/esm/transports/webtransport.js", "../node_modules/engine.io-client/build/esm/transports/index.js", "../node_modules/engine.io-client/build/esm/contrib/parseuri.js", "../node_modules/engine.io-client/build/esm/socket.js", "../node_modules/engine.io-client/build/esm/index.js", "../node_modules/socket.io-client/build/esm/url.js", "../node_modules/socket.io-parser/build/esm/index.js", "../node_modules/socket.io-parser/build/esm/is-binary.js", "../node_modules/socket.io-parser/build/esm/binary.js", "../node_modules/socket.io-client/build/esm/on.js", "../node_modules/socket.io-client/build/esm/socket.js", "../node_modules/socket.io-client/build/esm/contrib/backo2.js", "../node_modules/socket.io-client/build/esm/manager.js", "../node_modules/socket.io-client/build/esm/index.js", "../src/map.ts"],
  "sourcesContent": ["const PACKET_TYPES = Object.create(null); // no Map = no polyfill\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nObject.keys(PACKET_TYPES).forEach(key => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexport { PACKET_TYPES, PACKET_TYPES_REVERSE, ERROR_PACKET };\n", "import { PACKET_TYPES } from \"./commons.js\";\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = obj => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(PACKET_TYPES[type] + (data || \"\"));\n};\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nexport function encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data\n            .arrayBuffer()\n            .then(toArray)\n            .then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, encoded => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\nexport { encodePacket };\n", "// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nexport const encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexport const decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n", "import { ERROR_PACKET, PACKET_TYPES_REVERSE } from \"./commons.js\";\nimport { decode } from \"./contrib/base64-arraybuffer.js\";\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nexport const decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType)\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType)\n        };\n    }\n    const packetType = PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1)\n        }\n        : {\n            type: PACKET_TYPES_REVERSE[type]\n        };\n};\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = decode(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n", "import { encodePacket, encodePacketToBinary } from \"./encodePacket.js\";\nimport { decodePacket } from \"./decodePacket.js\";\nimport { ERROR_PACKET } from \"./commons.js\";\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        encodePacket(packet, false, encodedPacket => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = decodePacket(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexport function createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            encodePacketToBinary(packet, encodedPacket => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        }\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nexport function createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* READ_PAYLOAD */;\n                }\n                else if (state === 2 /* READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue(decodePacket(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(ERROR_PACKET);\n                    break;\n                }\n            }\n        }\n    });\n}\nexport const protocol = 4;\nexport { encodePacket, encodePayload, decodePacket, decodePayload };\n", "/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n", "export const globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\n", "import { globalThisShim as globalThis } from \"./globalThis.js\";\nexport function pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globalThis.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globalThis.clearTimeout;\nexport function installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThis);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThis);\n    }\n    else {\n        obj.setTimeoutFn = globalThis.setTimeout.bind(globalThis);\n        obj.clearTimeoutFn = globalThis.clearTimeout.bind(globalThis);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nexport function byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n", "// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nexport function encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nexport function decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n", "import { decodePacket } from \"engine.io-parser\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions } from \"./util.js\";\nimport { encode } from \"./contrib/parseqs.js\";\nclass TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexport class Transport extends Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        installTimerFunctions(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = decodePacket(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port !== 443)) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = encode(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\n", "// imported from https://github.com/unshiftio/yeast\n'use strict';\nconst alphabet = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_'.split(''), length = 64, map = {};\nlet seed = 0, i = 0, prev;\n/**\n * Return a string representing the specified number.\n *\n * @param {Number} num The number to convert.\n * @returns {String} The string representation of the number.\n * @api public\n */\nexport function encode(num) {\n    let encoded = '';\n    do {\n        encoded = alphabet[num % length] + encoded;\n        num = Math.floor(num / length);\n    } while (num > 0);\n    return encoded;\n}\n/**\n * Return the integer value specified by the given string.\n *\n * @param {String} str The string to convert.\n * @returns {Number} The integer value represented by the string.\n * @api public\n */\nexport function decode(str) {\n    let decoded = 0;\n    for (i = 0; i < str.length; i++) {\n        decoded = decoded * length + map[str.charAt(i)];\n    }\n    return decoded;\n}\n/**\n * Yeast: A tiny growing id generator.\n *\n * @returns {String} A unique id.\n * @api public\n */\nexport function yeast() {\n    const now = encode(+new Date());\n    if (now !== prev)\n        return seed = 0, prev = now;\n    return now + '.' + encode(seed++);\n}\n//\n// Map each character to its index.\n//\nfor (; i < length; i++)\n    map[alphabet[i]] = i;\n", "// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexport const hasCORS = value;\n", "// browser shim for xmlhttprequest module\nimport { hasCORS } from \"../contrib/has-cors.js\";\nimport { globalThisShim as globalThis } from \"../globalThis.js\";\nexport function XHR(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globalThis[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\nexport function createCookieJar() { }\n", "import { Transport } from \"../transport.js\";\nimport { yeast } from \"../contrib/yeast.js\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nimport { createCookieJar, XHR as XMLHttpRequest, } from \"./xmlhttprequest.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions, pick } from \"../util.js\";\nimport { globalThisShim as globalThis } from \"../globalThis.js\";\nfunction empty() { }\nconst hasXHR2 = (function () {\n    const xhr = new XMLHttpRequest({\n        xdomain: false,\n    });\n    return null != xhr.responseType;\n})();\nexport class Polling extends Transport {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        this.polling = false;\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n        /**\n         * XHR supports binary\n         */\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n        if (this.opts.withCredentials) {\n            this.cookieJar = createCookieJar();\n        }\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this.poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this.polling || !this.writable) {\n            let total = 0;\n            if (this.polling) {\n                total++;\n                this.once(\"pollComplete\", function () {\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                total++;\n                this.once(\"drain\", function () {\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    poll() {\n        this.polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        decodePayload(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this.polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this.poll();\n            }\n            else {\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        encodePayload(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = yeast();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n    /**\n     * Creates a request.\n     *\n     * @param {String} method\n     * @private\n     */\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd, cookieJar: this.cookieJar }, this.opts);\n        return new Request(this.uri(), opts);\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexport class Request extends Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(uri, opts) {\n        super();\n        installTimerFunctions(this, opts);\n        this.opts = opts;\n        this.method = opts.method || \"GET\";\n        this.uri = uri;\n        this.data = undefined !== opts.data ? opts.data : null;\n        this.create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    create() {\n        var _a;\n        const opts = pick(this.opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this.opts.xd;\n        const xhr = (this.xhr = new XMLHttpRequest(opts));\n        try {\n            xhr.open(this.method, this.uri, true);\n            try {\n                if (this.opts.extraHeaders) {\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this.opts.extraHeaders) {\n                        if (this.opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this.opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this.method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this.opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this.opts.withCredentials;\n            }\n            if (this.opts.requestTimeout) {\n                xhr.timeout = this.opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this.opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(xhr);\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this.onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this.onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            xhr.send(this.data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this.onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this.index = Request.requestsCount++;\n            Request.requests[this.index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    onError(err) {\n        this.emitReserved(\"error\", err, this.xhr);\n        this.cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    cleanup(fromError) {\n        if (\"undefined\" === typeof this.xhr || null === this.xhr) {\n            return;\n        }\n        this.xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this.xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this.index];\n        }\n        this.xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    onLoad() {\n        const data = this.xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this.cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this.cleanup();\n    }\n}\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globalThis ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\n", "import { globalThisShim as globalThis } from \"../globalThis.js\";\nexport const nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexport const WebSocket = globalThis.WebSocket || globalThis.MozWebSocket;\nexport const usingBrowserWebSocket = true;\nexport const defaultBinaryType = \"arraybuffer\";\n", "import { Transport } from \"../transport.js\";\nimport { yeast } from \"../contrib/yeast.js\";\nimport { pick } from \"../util.js\";\nimport { nextTick, usingBrowserWebSocket, WebSocket, } from \"./websocket-constructor.js\";\nimport { encodePacket } from \"engine.io-parser\";\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nexport class WS extends Transport {\n    /**\n     * WebSocket transport constructor.\n     *\n     * @param {Object} opts - connection options\n     * @protected\n     */\n    constructor(opts) {\n        super(opts);\n        this.supportsBinary = !opts.forceBase64;\n    }\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        if (!this.check()) {\n            // let probe timeout\n            return;\n        }\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : pick(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws =\n                usingBrowserWebSocket && !isReactNative\n                    ? protocols\n                        ? new WebSocket(uri, protocols)\n                        : new WebSocket(uri)\n                    : new WebSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            encodePacket(packet, this.supportsBinary, (data) => {\n                // always create a new object (GH-437)\n                const opts = {};\n                if (!usingBrowserWebSocket) {\n                    if (packet.options) {\n                        opts.compress = packet.options.compress;\n                    }\n                    if (this.opts.perMessageDeflate) {\n                        const len = \n                        // @ts-ignore\n                        \"string\" === typeof data ? Buffer.byteLength(data) : data.length;\n                        if (len < this.opts.perMessageDeflate.threshold) {\n                            opts.compress = false;\n                        }\n                    }\n                }\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    if (usingBrowserWebSocket) {\n                        // TypeError is thrown when passing the second argument on Safari\n                        this.ws.send(data);\n                    }\n                    else {\n                        this.ws.send(data, opts);\n                    }\n                }\n                catch (e) {\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = yeast();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n    /**\n     * Feature detection for WebSocket.\n     *\n     * @return {Boolean} whether this transport is available.\n     * @private\n     */\n    check() {\n        return !!WebSocket;\n    }\n}\n", "import { Transport } from \"../transport.js\";\nimport { nextTick } from \"./websocket-constructor.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        // @ts-ignore\n        if (typeof WebTransport !== \"function\") {\n            return;\n        }\n        // @ts-ignore\n        this.transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        this.transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this.transport.ready.then(() => {\n            this.transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this.writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this.writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this.writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this.transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n", "import { Polling } from \"./polling.js\";\nimport { WS } from \"./websocket.js\";\nimport { WT } from \"./webtransport.js\";\nexport const transports = {\n    websocket: WS,\n    webtransport: WT,\n    polling: Polling,\n};\n", "// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nexport function parse(str) {\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n", "import { transports } from \"./transports/index.js\";\nimport { installTimerFunctions, byteLength } from \"./util.js\";\nimport { decode } from \"./contrib/parseqs.js\";\nimport { parse } from \"./contrib/parseuri.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { protocol } from \"engine.io-parser\";\nimport { defaultBinaryType } from \"./transports/websocket-constructor.js\";\nexport class Socket extends Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts = {}) {\n        super();\n        this.binaryType = defaultBinaryType;\n        this.writeBuffer = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            uri = parse(uri);\n            opts.hostname = uri.host;\n            opts.secure = uri.protocol === \"https\" || uri.protocol === \"wss\";\n            opts.port = uri.port;\n            if (uri.query)\n                opts.query = uri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = parse(opts.host).host;\n        }\n        installTimerFunctions(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = opts.transports || [\n            \"polling\",\n            \"websocket\",\n            \"webtransport\",\n        ];\n        this.writeBuffer = [];\n        this.prevBufferLen = 0;\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = decode(this.opts.query);\n        }\n        // set on handshake\n        this.id = null;\n        this.upgrades = null;\n        this.pingInterval = null;\n        this.pingTimeout = null;\n        // set on heartbeat\n        this.pingTimeoutTimer = null;\n        if (typeof addEventListener === \"function\") {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this.beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this.beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                this.offlineEventListener = () => {\n                    this.onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                addEventListener(\"offline\", this.offlineEventListener, false);\n            }\n        }\n        this.open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        return new transports[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    open() {\n        let transport;\n        if (this.opts.rememberUpgrade &&\n            Socket.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1) {\n            transport = \"websocket\";\n        }\n        else if (0 === this.transports.length) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        else {\n            transport = this.transports[0];\n        }\n        this.readyState = \"opening\";\n        // Retry with the next transport if the transport is disabled (jsonp: false)\n        try {\n            transport = this.createTransport(transport);\n        }\n        catch (e) {\n            this.transports.shift();\n            this.open();\n            return;\n        }\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        if (this.transport) {\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this.onDrain.bind(this))\n            .on(\"packet\", this.onPacket.bind(this))\n            .on(\"error\", this.onError.bind(this))\n            .on(\"close\", (reason) => this.onClose(\"transport close\", reason));\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    probe(name) {\n        let transport = this.createTransport(name);\n        let failed = false;\n        Socket.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    Socket.priorWebsocketSuccess = \"websocket\" === transport.name;\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this.upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        Socket.priorWebsocketSuccess = \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n        // we check for `readyState` in case an `open`\n        // listener already closed the socket\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            let i = 0;\n            const l = this.upgrades.length;\n            for (; i < l; i++) {\n                this.probe(this.upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            this.resetPingTimeout();\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this.sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this.onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this.upgrades = this.filterUpgrades(data.upgrades);\n        this.pingInterval = data.pingInterval;\n        this.pingTimeout = data.pingTimeout;\n        this.maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this.resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    resetPingTimeout() {\n        this.clearTimeoutFn(this.pingTimeoutTimer);\n        this.pingTimeoutTimer = this.setTimeoutFn(() => {\n            this.onClose(\"ping timeout\");\n        }, this.pingInterval + this.pingTimeout);\n        if (this.opts.autoUnref) {\n            this.pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    onDrain() {\n        this.writeBuffer.splice(0, this.prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this.prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this.getWritablePackets();\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this.prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    getWritablePackets() {\n        const shouldCheckPayloadSize = this.maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += byteLength(data);\n            }\n            if (i > 0 && payloadSize > this.maxPayload) {\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        return this.writeBuffer;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this.sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    send(msg, options, fn) {\n        this.sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this.onClose(\"forced close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    onError(err) {\n        Socket.priorWebsocketSuccess = false;\n        this.emitReserved(\"error\", err);\n        this.onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            // clear timers\n            this.clearTimeoutFn(this.pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (typeof removeEventListener === \"function\") {\n                removeEventListener(\"beforeunload\", this.beforeunloadEventListener, false);\n                removeEventListener(\"offline\", this.offlineEventListener, false);\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this.prevBufferLen = 0;\n        }\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        let i = 0;\n        const j = upgrades.length;\n        for (; i < j; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\nSocket.protocol = protocol;\n", "import { Socket } from \"./socket.js\";\nexport { Socket };\nexport const protocol = Socket.protocol;\nexport { Transport } from \"./transport.js\";\nexport { transports } from \"./transports/index.js\";\nexport { installTimerFunctions } from \"./util.js\";\nexport { parse } from \"./contrib/parseuri.js\";\nexport { nextTick } from \"./transports/websocket-constructor.js\";\n", "import { parse } from \"engine.io-client\";\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nexport function url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        obj = parse(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n", "import { Emitter } from \"@socket.io/component-emitter\";\nimport { deconstructPacket, reconstructPacket } from \"./binary.js\";\nimport { isBinary, hasBinary } from \"./is-binary.js\";\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\",\n    \"connect_error\",\n    \"disconnect\",\n    \"disconnecting\",\n    \"newListener\",\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexport const protocol = 5;\nexport var PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nexport class Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if (hasBinary(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = deconstructPacket(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nexport class Decoder extends Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if (isBinary(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = reconstructPacket(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\n", "const withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nexport function isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nexport function hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n", "import { isBinary } from \"./is-binary.js\";\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nexport function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nexport function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n", "export function on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n", "import { PacketType } from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nexport class Socket extends Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            on(io, \"open\", this.onopen.bind(this)),\n            on(io, \"packet\", this.onpacket.bind(this)),\n            on(io, \"error\", this.onerror.bind(this)),\n            on(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = this.io.engine &&\n            this.io.engine.transport &&\n            this.io.engine.transport.writable;\n        const discardPacket = this.flags.volatile && (!isTransportWritable || !this.connected);\n        if (discardPacket) {\n        }\n        else if (this.connected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        this.acks[id] = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, [null, ...args]);\n        };\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        // the timeout flag is optional\n        const withErr = this.flags.timeout !== undefined || this._opts.ackTimeout !== undefined;\n        return new Promise((resolve, reject) => {\n            args.push((arg1, arg2) => {\n                if (withErr) {\n                    return arg1 ? reject(arg1) : resolve(arg2);\n                }\n                else {\n                    return resolve(arg1);\n                }\n            });\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                // the packet has already been acknowledged\n                return;\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        if (null != packet.id) {\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            self.packet({\n                type: PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowlegement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (\"function\" === typeof ack) {\n            ack.apply(this, packet.data);\n            delete this.acks[packet.id];\n        }\n        else {\n        }\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this.emitReserved(\"connect\");\n        this._drainQueue(true);\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            this.packet({ type: PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\n", "/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nexport function Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n", "import { Socket as Engine, installTimerFunctions, nextTick, } from \"engine.io-client\";\nimport { Socket } from \"./socket.js\";\nimport * as parser from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Backoff } from \"./contrib/backo2.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\nexport class Manager extends Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        installTimerFunctions(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        this.engine = new Engine(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = on(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = on(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push(on(socket, \"ping\", this.onping.bind(this)), on(socket, \"data\", this.ondata.bind(this)), on(socket, \"error\", this.onerror.bind(this)), on(socket, \"close\", this.onclose.bind(this)), on(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        nextTick(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n        if (this.engine)\n            this.engine.close();\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called upon engine close.\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        this.cleanup();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\n", "import { url } from \"./url.js\";\nimport { Manager } from \"./manager.js\";\nimport { Socket } from \"./socket.js\";\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = url(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        io = new Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            cache[id] = new Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager,\n    Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nexport { protocol } from \"socket.io-parser\";\n/**\n * Expose constructors for standalone build.\n *\n * @public\n */\nexport { Manager, Socket, lookup as io, lookup as connect, lookup as default, };\n", "import { io, Socket } from \"socket.io-client\";\r\n\r\ninterface ServerToClientEvents {\r\n    pingAt: (data:string) => void;\r\n    currentMapData: (data:string) => void;\r\n}\r\n\r\ninterface ClientToServerEvents {\r\n    requestPing: (data:{pingX:number, pingY:number}) => void;\r\n\r\n    changeTurn: (data: {id: ID}) => void;\r\n\r\n    createNewMap: (data: {name:string}) => void; \r\n\r\n    switchBlockerType: (data:{type:number}) => void;\r\n    invertBlockers: () => void;\r\n    \r\n    setMapData: (data:{gridColor?:`#${string}`, map?:string, y?:number, x?:number, offsetX?:number, offsetY?:number, diagonalMovement?:string, system?:string}) => void;\r\n    changeSelectedMap: (data:{selectedMap:string}) => void;\r\n\r\n    addDrawing: (data:{shape:string, visible:boolean, x?:number, y?:number, link?:ID, radius?:number,\r\n        trueColor?:`#${string}`, width?:number, height?:number, verts?:tmpVert[],\r\n        angle?:number, range?:number, is90Deg?:boolean}) => void;\r\n    editDrawing: (data:{id:ID, group?:number|null, verts?:Vert[], visible?:boolean, radius?:number,\r\n        range?:number, x?:number, y?:number, both?:boolean, moveShapeGroup?:boolean, angle?:number}) => void;\r\n    removeDrawing: (data:{id:ID}) => void;\r\n    \r\n    addVert: (data:{id:ID, vertID:ID}) => void;\r\n    editVert: (data:{id:ID, vertID:ID, x?:number, y?:number}) => void;\r\n    removeVert: (data:{type: 'blocker'|'line', id:ID, vertID:ID}) => void;\r\n\r\n    addPolyBlocker: (data:{x:number, y:number, offset:{min:number}}) => void;\r\n    addCustomPolyBlocker: (data:{newPolyBlockerVerts:tmpVert[]}) => void;\r\n    movePolyBlocker: (data:{id:ID, offsetX?:number, offsetY?:number}) => void;\r\n    togglePolyBlocker: (data:{id:ID}) => void;\r\n    removePolyBlocker: (data:{id:ID}) => void;\r\n\r\n    addBlocker: (data:{x?:number, y?:number, width?:number, height?:number}) => void;\r\n    editBlocker: (data:{id:ID, x?:number, y?:number, width?:number, height?:number}) => void;\r\n    removeBlocker: (data:{id:ID}) => void;\r\n    \r\n    createToken: (data:{size?:number, dm?:boolean, image?:string, text:string, x?:number, y?:number, concentrating?:boolean,\r\n        status?:string, layer:number, group?:number, hideTracker?:boolean, hp?:`${number}/${number}`,\r\n        notes?:string, initiative?:number, name?:string, ac?:number, hidden?:boolean}) => void;\r\n    moveToken: (data:{id:ID, x:number, y:number, bypassLink:boolean}) => void;\r\n    editToken: (data:{id:ID, size?:number, status?:string, layer?:number, group?:number|null, text?:string,\r\n        dm?:boolean, image?:string, hideTracker?:boolean, hp?:`${number}/${number}`|null, notes?:string,\r\n        initiative?:number|null, name?:string, ac?:number|null, mentalDef?:number|null, physicalDef?:number|null,\r\n        refDef?:number|null, fortDef?:number|null, willDef?:number|null, concentrating?:boolean}) => void;\r\n    setTokenHidden: (data:{id:ID, hidden:boolean}) => void;\r\n    removeToken: (data:{id:ID}) => void;    \r\n\r\n    switchTrackerPosition: (data:{origin:ID, target:ID}) => void;    \r\n    sortTracker: () => void;\r\n\r\n    \r\n    clearTokens: () => void;\r\n    clearDrawings: () => void;\r\n    clearBlockers: () => void;\r\n}\r\n\r\ntype ID = `${string}-${string}-${string}-${string}-${string}`;\r\n\r\ntype HTMLSVGElement = HTMLCanvasElement & SVGElement;\r\n\r\ninterface MapData {\r\n    blockerType: number,\r\n    gridColor: `#${string}`,\r\n    antiBlockerOn: boolean,\r\n    maps: string[],\r\n    mapName: string,\r\n    tokenList: string[],\r\n    dmTokenList: string[],\r\n    mapSourceList: string[],\r\n    map: string,\r\n    x: number,\r\n    y: number,\r\n    offsetX: number,\r\n    offsetY: number,\r\n    tokens: Token[],\r\n    drawings: Shape[],\r\n    polyBlockers: PolyBlocker[],\r\n    blockers: Blocker[],\r\n    removedTokens: number,\r\n    currentTurn: ID|undefined,\r\n    diagonalMovement: string,\r\n    system: string,\r\n}\r\n\r\ninterface PolyBlocker {\r\n    id: ID,\r\n    inactive: boolean,\r\n    verts: Vert[],\r\n}\r\n\r\ninterface Blocker {\r\n    id: ID,\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number,\r\n}\r\n\r\ninterface Token {\r\n    id: ID,\r\n    size: number,\r\n    x: number,\r\n    y: number,\r\n    image?: string,\r\n    dm: boolean,\r\n    layer: number,\r\n    name?: string,\r\n    notes?: string,\r\n    initiative?: number,\r\n    ac?: number,\r\n    mentalDef?: number,\r\n    physicalDef?: number,\r\n    refDef?: number,\r\n    fortDef?: number,\r\n    willDef?: number,\r\n    hp?: `${number}/${number}`,\r\n    status?: string,\r\n    group?: number,\r\n    concentrating?: boolean,\r\n    hideTracker?: boolean,\r\n    hidden?: boolean,\r\n    rotation?: number,\r\n    objectLock?: boolean,\r\n    text: string\r\n}\r\n\r\ninterface Shape {\r\n    id: ID,\r\n    visible: boolean,\r\n    shape: 'circle' | 'square' | 'cone' | '5ftLine' | 'vertexLine',\r\n    is90Deg: boolean,\r\n    trueColor: `#${string}`,\r\n    verts: Vert[],\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    radius: number,\r\n    height: number,\r\n    angle: number,\r\n    range: number,\r\n    group: number,\r\n    link: ID,\r\n}\r\n\r\ninterface Vert {\r\n    id: ID,\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\ninterface tmpVert {\r\n    x: number,\r\n    y: number,\r\n}\r\n\r\ninterface ContextMenuOption {\r\n    text: string,\r\n    callback: () => void,\r\n    hasSubMenu: boolean,\r\n}\r\n\r\ninterface SubContextMenuOption {\r\n    text: string,\r\n    callback: () => void,\r\n}\r\n\r\nconst socket : Socket<ServerToClientEvents, ClientToServerEvents> = io();\r\nlet starting = true;\r\nlet gridActive = true;\r\nlet gridSnap = true;\r\nlet sideMenuExpanded = true;\r\nconst blockerOutlineColor = \"violet\";\r\nconst shapeWidth = 2;\r\nconst GridLineWidth = 1;\r\nconst feetPerSquare = 5.0;\r\n\r\nif(!navigator.userAgent.includes(\"Chrome\") && !navigator.userAgent.indexOf(\"Firefox\")) {\r\n    alert(\"Room of thought is only supported for firefox and chrome. Some features may be unavailable!\");\r\n}\r\n\r\nlet offsetX = 0;\r\nlet offsetY = 0;\r\nlet GridColor:`#${string}` = \"#222222FF\";\r\nlet shapeColor:`#${string}` = \"#FF0000FF\";\r\n//Used to draw the hitbox of shapes to make it easier to move them\r\nconst $UI = {\r\n    systemSelect: document.getElementById(\"systemSelect\")! as HTMLInputElement,\r\n    AC13thAge: document.getElementById(\"AC13thAge\")! as HTMLDivElement,\r\n    mentalDef: document.getElementById(\"mentalDef\")! as HTMLInputElement,\r\n    physicalDef: document.getElementById(\"physicalDef\")! as HTMLInputElement,\r\n    AC4e: document.getElementById(\"AC4e\")! as HTMLDivElement,\r\n    refDef: document.getElementById(\"refDef\")! as HTMLInputElement,\r\n    fortDef: document.getElementById(\"fortDef\")! as HTMLInputElement,\r\n    willDef: document.getElementById(\"willDef\")! as HTMLInputElement,\r\n    diagonalTypeSelect: document.getElementById(\"diagonalType\")! as HTMLSelectElement,\r\n    hAlignHandles: document.getElementById(\"hAlignHandles\")! as HTMLDivElement,\r\n    vAlignHandles: document.getElementById(\"vAlignHandles\")! as HTMLDivElement,\r\n    startGridAligner: document.getElementById(\"startGridAligner\")! as HTMLButtonElement,\r\n    sideMenuCollapse: document.getElementById(\"sideMenuCollapse\")! as HTMLDivElement,\r\n    sideMenuToggle: document.getElementById(\"sideMenuToggle\")! as HTMLButtonElement,\r\n    sideMenuToggleIcon: document.getElementById(\"sideMenuToggleIcon\")!,\r\n    bulkTokenBox: document.getElementById(\"bulkTokenBox\")! as HTMLDivElement,\r\n    bulkTokenBoxHeader: document.getElementById(\"bulkTokenBoxHeader\")! as HTMLDivElement,\r\n    bulkTokenBoxBody: document.getElementById(\"bulkTokenBoxBody\")! as HTMLDivElement,\r\n    bulkTokenImageSelect: document.getElementById(\"bulkTokenImageSelect\")! as HTMLSelectElement,\r\n    bulkTokenNameInput: document.getElementById(\"bulkTokenNameInput\")! as HTMLInputElement,\r\n    bulkTokenAmountInput: document.getElementById(\"bulkTokenAmountInput\")! as HTMLInputElement,\r\n    bulkTokenSize: document.getElementById('bulkTokenSize')! as HTMLInputElement,\r\n    bulkTokenGroup: document.getElementById('bulkTokenGroup')! as HTMLInputElement,\r\n    bulkTokenHP: document.getElementById('bulkTokenHP')! as HTMLInputElement,\r\n    bulkTokenAC: document.getElementById('bulkTokenAC')! as HTMLInputElement,\r\n    bulkTokenInit: document.getElementById('bulkTokenInit')! as HTMLInputElement,\r\n    bulkTokenDex: document.getElementById('bulkTokenDex')! as HTMLInputElement,\r\n    bulkTokenHideTracker: document.getElementById('bulkTokenHideTracker')! as HTMLInputElement,\r\n    bulkTokenHideToken: document.getElementById('bulkTokenHideToken')! as HTMLInputElement,\r\n    bulkTokenRollOnce: document.getElementById('bulkTokenRollOnce')! as HTMLInputElement,\r\n    bulkTokenRollEach: document.getElementById('bulkTokenRollEach')! as HTMLInputElement,\r\n    bulkTokenConfirm: document.getElementById(\"bulkTokenConfirm\")! as HTMLButtonElement,    \r\n    mapOptionsMenuBody: document.getElementById(\"mapOptionsMenuBody\")! as HTMLDivElement,\r\n    mapOptionsMenuClose: document.getElementById(\"mapOptionsMenuClose\")! as HTMLButtonElement,\r\n    mapOptionsMenuBox: document.getElementById(\"mapOptionsMenuBox\")! as HTMLDivElement,\r\n    notesBox: document.getElementById(\"notesBox\")! as HTMLDivElement,\r\n    notesBoxTextArea: document.getElementById(\"notesBoxTextArea\")! as HTMLTextAreaElement,\r\n    gridMap: document.getElementById(\"gridMap\")! as HTMLCanvasElement,\r\n    board: document.getElementById(\"board\")! as HTMLDivElement,\r\n    viewport: document.getElementById(\"viewport\")! as HTMLDivElement,\r\n    mapImage: document.getElementById(\"mapImage\")! as HTMLImageElement,\r\n    shapeMap: document.getElementById(\"shapeMap\")! as HTMLSVGElement,\r\n    tokensDiv: document.getElementById(\"tokens\")! as HTMLDivElement,\r\n    blockersDiv: document.getElementById(\"blockers\")! as HTMLDivElement,\r\n    mapSourceSelect: document.getElementById(\"mapSource\")! as HTMLSelectElement,\r\n    mapXInput: document.getElementById(\"mapX\")! as HTMLInputElement,\r\n    mapYInput: document.getElementById(\"mapY\")! as HTMLInputElement,\r\n    offsetXInput: document.getElementById(\"offsetX\")! as HTMLInputElement,\r\n    offsetYInput: document.getElementById(\"offsetY\")! as HTMLInputElement,\r\n    blockerTypeSelect: document.getElementById(\"blockerType\")! as HTMLSelectElement,\r\n    initiativeTrackerDiv: document.getElementById(\"initiativeTrackerDiv\")! as HTMLDivElement,\r\n    noteArea: document.getElementById(\"notesTextArea\")! as HTMLTextAreaElement,\r\n    detailsScreen: document.getElementById(\"detailsScreen\")! as HTMLDivElement,\r\n    initiativeInput: document.getElementById(\"detailsInitiative\")! as HTMLInputElement,\r\n    nameInput: document.getElementById(\"detailsNameInput\")! as HTMLInputElement,\r\n    acInput: document.getElementById(\"armorClass\")! as HTMLInputElement,\r\n    currentHpInput: document.getElementById(\"currentHitpoints\")! as HTMLInputElement,\r\n    maxHpInput: document.getElementById(\"maxHitpoints\")! as HTMLInputElement,\r\n    groupIdInput: document.getElementById(\"detailsGroup\")! as HTMLInputElement,\r\n    statusInput: document.getElementById(\"detailsStatusInput\")! as HTMLInputElement,\r\n    detailsIcon: document.getElementById(\"detailsIcon\")! as HTMLImageElement,\r\n    concentratingInput: document.getElementById(\"concentrating\")! as HTMLButtonElement,\r\n    hideTrackerInput: document.getElementById(\"visibility\")! as HTMLButtonElement,\r\n    hpIcon: document.getElementById(\"hitpointsIcon\")! as HTMLImageElement,\r\n    sideMenu: document.getElementById(\"sideMenu\")! as HTMLDivElement,\r\n    gridColorPicker: document.getElementById(\"gridColorPicker\")! as HTMLInputElement,\r\n    mapSelect: document.getElementById(\"mapSelect\")! as HTMLSelectElement,\r\n    createNewMapButton: document.getElementById(\"createNewMapButton\")! as HTMLButtonElement,\r\n    polyBlockers: document.getElementById(\"polyBlockers\")! as HTMLDivElement,\r\n    polyBlockerHandles: document.getElementById(\"polyBlockerHandles\")! as HTMLDivElement,\r\n    newPolyBlockerHandles: document.getElementById(\"newPolyBlockerHandles\")! as HTMLDivElement,\r\n    shapeHandles: document.getElementById(\"shapeHandles\")! as HTMLDivElement,\r\n    antiBlockerMap: document.getElementById(\"antiBlockerMap\")! as HTMLCanvasElement,\r\n    initSearch: document.getElementById(\"initSearch\")! as HTMLInputElement,\r\n    quickPolyButton: document.getElementById(\"quickPolyButton\")! as HTMLButtonElement,\r\n    colorPickerButton: document.getElementById(\"colorPickerButton\")! as HTMLButtonElement,\r\n    customMenu: document.getElementById(\"contextMenu\")! as HTMLDivElement,\r\n    sortTracker: document.getElementById(\"sortTracker\")! as HTMLButtonElement,\r\n    toggleSettings: document.getElementById(\"toggleSettingsButton\")! as HTMLButtonElement,\r\n    toggleGrid: document.getElementById(\"toggleGridButton\")! as HTMLButtonElement,\r\n    toggleSnap: document.getElementById(\"toggleSnapButton\")! as HTMLButtonElement,\r\n    colorPickerPreview: document.getElementById(\"colorPickerPreview\")! as HTMLDivElement,\r\n    redSlider: document.getElementById(\"redSlider\")! as HTMLInputElement,\r\n    greenSlider: document.getElementById(\"greenSlider\")! as HTMLInputElement,\r\n    blueSlider: document.getElementById(\"blueSlider\")! as HTMLInputElement,\r\n    opacitySlider: document.getElementById(\"opacitySlider\")! as HTMLInputElement,\r\n    toggleBlockerEditing: document.getElementById(\"toggleBlockerEditing\")! as HTMLButtonElement,\r\n    clearTokens: document.getElementById(\"clearTokensButton\")!,\r\n    clearDrawings: document.getElementById(\"clearDrawingsButton\")!,\r\n    clearBlockers: document.getElementById(\"clearBlockersButton\")!,\r\n    invertBlockers: document.getElementById(\"invertBlockerButton\")!,\r\n    togglePlayerMode: document.getElementById(\"togglePlayerMode\")!,\r\n    customSubMenu: document.getElementById(\"subContextMenu\")!,\r\n}\r\nfor (const [elName, element] of Object.entries($UI)) {\r\n    if (element === null) throw new Error(`${elName} is undefined! Check the IDs!`);\r\n}\r\n\r\n//Detail screen vars\r\nconst gridCanvas = $UI.gridMap.getContext(\"2d\")!;\r\nconst antiBlockerContext = $UI.antiBlockerMap.getContext(\"2d\", {willReadFrequently: true})!;\r\nlet mapData : MapData;\r\nlet gridSize : {x:number, y:number, min:number};\r\nconst blockerDragOffset = {x: 0, y: 0};\r\nconst shapeDragOffset = {x: 0, y: 0};\r\n\r\nconst blockerMarkers = {x: 0, y: 0, width: 0, height: 0};\r\nconst circleMarkers = {x: 0, y: 0, radius: 0};\r\nconst squareMarkers = {x: 0, y: 0, width: 0, height: 0};\r\nconst lineMarkers = {x: 0, y: 0, destX: 0, destY: 0, range: 100};\r\nconst thickLineMarkers = {x: 0, y: 0, range: 100, linkId: '0-0-0-0-0' as ID};\r\nconst coneMarkers = {x: 0, y: 0, range: 100, tokenSize: 1, is90Deg: false, linkId: '0-0-0-0-0' as ID};\r\n\r\nlet isDM = false;\r\nconst shapeColorCookie = getCookie(\"shapeColor\");\r\nif (shapeColorCookie === \"\") {\r\n    setCookie(\"shapeColor\", shapeColor);\r\n} else {\r\n    shapeColor = shapeColorCookie as `#${string}`;\r\n}\r\n\r\nconst flag = {\r\n    blockerEditMode: false,\r\n    playerMode: false,\r\n    quickPolyBlockerMode: false,\r\n    gridAlignMode: false,\r\n    controlPressed: false,\r\n    isPanning: false,\r\n    isPlacingBlocker: false,\r\n    isPlacingSquare: false,\r\n    isPlacingLine: false,\r\n    isPlacing5ftLine: false,\r\n    isPlacingCone: false,\r\n    isMovingShape: false,\r\n    isMovingCone: false,\r\n    isMoving5ftLine: false,\r\n    isDraggingBlocker: false,\r\n    isPlacingBulkOrigin: false,\r\n}\r\nconst draggedBlocker = {x: 0, y: 0};\r\nconst oldMousePos = {x: 0, y: 0};\r\nconst oldScrollPos = {x: 0, y: 0};\r\nlet movingShapeId : ID;\r\nlet selectedToken : ID;\r\nlet selectedBlocker : ID;\r\nlet selectedShapeId : ID;\r\nlet selectedTokenData : Token;\r\nlet oldDataString = \"\";\r\nlet oldParsedData : MapData;\r\nlet baseTokenIndex = 4;\r\nlet shapeDragStartAngle = 0;\r\nconst polyDragOffset = {x: 0, y: 0};\r\nlet newPolyBlockerVerts = new Array<tmpVert>();\r\n\r\nconst mapPreload = new Image();\r\n\r\nupdateButtonColors();\r\n\r\nfunction Setup() {\r\n    if (getCookie(\"isDM\") == '1') {\r\n        isDM = true;\r\n    } else {\r\n        const elementsToRemove = document.getElementsByClassName(\"dmOnly\");\r\n        for (let i = elementsToRemove.length - 1; i >= 0; i--) {\r\n            elementsToRemove[i]?.parentElement?.removeChild(elementsToRemove[i]);\r\n        }\r\n    }\r\n\r\n    SyncSideMenu();\r\n    \r\n    setColor(shapeColor);\r\n    $UI.quickPolyButton.style.display = (mapData.blockerType == 1 && isDM) ? \"\" : \"none\";\r\n    \r\n    if (!mapData.blockerType) {\r\n        socket.emit(\"switchBlockerType\", {type: 0});\r\n    }\r\n    $UI.blockerTypeSelect.value = mapData.blockerType?.toString() ?? \"0\";\r\n    \r\n    if (isDM) {\r\n        $UI.shapeMap.style.zIndex = '941';\r\n        baseTokenIndex = 500;\r\n    } else {\r\n        baseTokenIndex = 0;\r\n    }\r\n}\r\n\r\nsocket.on('pingAt', (dataString) => {\r\n    const data = JSON.parse(dataString) as {pingX:number, pingY:number};\r\n    const pingCircle = document.createElement('div');\r\n    pingCircle.className = 'ping';\r\n    pingCircle.style.left = data.pingX.toString();\r\n    pingCircle.style.top = data.pingY.toString();\r\n    pingCircle.style.setProperty('transform', `translate(-50%, -50%)`);\r\n    $UI.board.appendChild(pingCircle);\r\n    setTimeout(() => {\r\n        $UI.board.removeChild(pingCircle);\r\n    }, 5000);\r\n});\r\n\r\nsocket.on('currentMapData', (dataString) => {\r\n    mapData = JSON.parse(dataString) as MapData;\r\n    if (oldDataString == dataString) { return; }\r\n\r\n    if (starting) {\r\n        Setup();\r\n        starting = false;\r\n    } \r\n\r\n    GridColor = mapData.gridColor;\r\n    document.body.style.setProperty(\"--antiBlocker-color\", (isDM && !flag.playerMode)?\"#00000080\":\"#000000FF\");\r\n    document.body.style.setProperty(\"--blocker-color\", mapData.antiBlockerOn ? ((isDM && !flag.playerMode)?\"#00000080\":\"#000000FF\") : \"#00000000\");\r\n\r\n    $UI.mapSelect.innerHTML = \"\";\r\n    for (const map of mapData.maps) {\r\n        $UI.mapSelect.insertAdjacentHTML('beforeend', `<option value=\"${map}\">${map}</option>`);\r\n    }\r\n    $UI.mapSelect.value = mapData.mapName;\r\n\r\n    if (document.activeElement != $UI.bulkTokenImageSelect) {\r\n        $UI.bulkTokenImageSelect.innerHTML = \"\";\r\n        const tmpOption = document.createElement(\"option\");\r\n        tmpOption.value = \"number\";\r\n        tmpOption.innerText = \"Auto number\";\r\n        $UI.bulkTokenImageSelect.append(tmpOption);\r\n        for (const playerImage of mapData.tokenList) {\r\n            $UI.bulkTokenImageSelect.insertAdjacentHTML('beforeend', `<option value=\"${playerImage}\">${playerImage}</option>`);\r\n        }\r\n        for (const dmTokenImage of mapData.dmTokenList) {\r\n            $UI.bulkTokenImageSelect.insertAdjacentHTML('beforeend', `<option value=\"${dmTokenImage}\">${dmTokenImage}</option>`);\r\n        }\r\n    }\r\n\r\n    if (document.activeElement != $UI.mapSourceSelect) {\r\n        $UI.mapSourceSelect.innerHTML = \"\";\r\n        for (const mapSource of mapData.mapSourceList) {\r\n            $UI.mapSourceSelect.insertAdjacentHTML('beforeend', `<option value=\"${mapSource}\">${mapSource}</option>`);\r\n        }\r\n        $UI.mapSourceSelect.value = mapData.map;\r\n    }\r\n\r\n    if (document.activeElement!=$UI.mapYInput) { $UI.mapYInput.value = mapData.y.toString(); }\r\n    if (document.activeElement!=$UI.mapXInput) { $UI.mapXInput.value = mapData.x.toString(); }\r\n    if (document.activeElement!=$UI.offsetXInput) { $UI.offsetXInput.value = mapData.offsetX.toString(); }\r\n    if (document.activeElement!=$UI.offsetYInput) { $UI.offsetYInput.value = mapData.offsetY.toString(); }\r\n    if (document.activeElement!=$UI.gridColorPicker) { $UI.gridColorPicker.value = mapData.gridColor.toString(); }\r\n    if (document.activeElement!=$UI.diagonalTypeSelect) { $UI.diagonalTypeSelect.value = mapData.diagonalMovement; }\r\n    if (document.activeElement!=$UI.systemSelect) { $UI.systemSelect.value = mapData.system; }\r\n    offsetX = mapData.offsetX;\r\n    offsetY = mapData.offsetY;\r\n    if (mapData.map!=(oldParsedData?oldParsedData.map:\"\")) {\r\n        console.log(\"Switching/Redrawing map!\");\r\n        selectedToken = `0-0-0-0-0`;\r\n        selectedBlocker = `0-0-0-0-0`;\r\n        selectedShapeId = `0-0-0-0-0`;\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        mapPreload.src = \"/public/maps/\" + mapData.map;\r\n\r\n        mapPreload.onload = () => {\r\n            $UI.blockerTypeSelect.value = mapData.blockerType?.toString() ?? \"0\";\r\n            $UI.mapSourceSelect.value = mapData.map;\r\n            $UI.mapYInput.value = mapData.y.toString();\r\n            $UI.mapXInput.value = mapData.x.toString();\r\n            $UI.offsetXInput.value = mapData.offsetX.toString();\r\n            $UI.offsetYInput.value = mapData.offsetY.toString();\r\n            flag.quickPolyBlockerMode = false;\r\n            $UI.quickPolyButton.style.display = (mapData.blockerType == 1 && isDM) ? \"\" : \"none\";\r\n            drawCanvas();\r\n            updateButtonColors();\r\n            oldDataString = dataString;\r\n            oldParsedData = (oldDataString ? JSON.parse(oldDataString) : oldParsedData) as MapData;\r\n        }\r\n    } else {\r\n        let skipMapRedraw = true;\r\n        if (oldParsedData.x !== mapData.x) { skipMapRedraw = false; }\r\n        if (oldParsedData.y !== mapData.y) { skipMapRedraw = false; }\r\n        if (oldParsedData.offsetX !== mapData.offsetX) { skipMapRedraw = false; }\r\n        if (oldParsedData.offsetY !== mapData.offsetY) { skipMapRedraw = false; }\r\n        if (oldParsedData.gridColor !== mapData.gridColor) { skipMapRedraw = false; }\r\n        drawCanvas(skipMapRedraw);\r\n        oldDataString = dataString;\r\n        oldParsedData = (oldDataString?JSON.parse(oldDataString):oldParsedData) as MapData;\r\n    }\r\n    $UI.AC4e.style.display = mapData.system !== '4e' ? 'none' : '';\r\n    $UI.AC13thAge.style.display = mapData.system !== '13thAge' ? 'none' : '';\r\n});\r\n\r\nfunction returnToken(id:ID) {\r\n    return mapData.tokens.find((t) => t.id === id);\r\n}\r\n\r\n//#region Drag system\r\nlet draggableElements = new Array<HTMLElement>();\r\nfunction draggableElement(element:HTMLElement,\r\nfollowMouse:boolean,\r\npickupElement?:(e:MouseEvent, o:{x:number, y:number})=>void,\r\ndropElement?:(e:MouseEvent, o:{x:number, y:number})=>void,\r\nmoveElement?:(e:MouseEvent, o:{x:number, y:number})=>void,\r\ncheckBlocker?:boolean,\r\nfollowCondition?:(doFollow:boolean[], e:MouseEvent)=>void,\r\nignoreElement?:HTMLElement,\r\nzoomCompensation=true) {\r\n    const offset = {x: 0, y: 0};\r\n    const doFollow : boolean[] = [false];\r\n    element.draggable = false;\r\n    element.setAttribute(\"dragging\", '0');\r\n    element.setAttribute(\"checkBlocker\", checkBlocker?.toString() ?? \"false\");\r\n    element.addEventListener(\"mousedown\", (e) => {\r\n        if (e.button !== 0) { return; }\r\n        if (e.target !== null && ignoreElement !== undefined && getAncestry(e.target as HTMLElement).includes(ignoreElement)) { return; }\r\n        if (checkBlocker && !CheckAntiBlockerPixel(e) && (!isDM || flag.playerMode)) {\r\n            e.preventDefault();\r\n            flag.isPanning = true;\r\n            oldMousePos.x = e.pageX;\r\n            oldMousePos.y = e.pageY;\r\n            oldScrollPos.x = $UI.viewport.scrollLeft;\r\n            oldScrollPos.y = $UI.viewport.scrollTop;\r\n            document.body.style.cursor = \"grabbing\";\r\n            return;\r\n        }\r\n        closeMenu();\r\n        closeSubMenu();\r\n        e.preventDefault();\r\n        element.style.cursor = \"grabbing\";\r\n        element.style.userSelect = \"none\";\r\n        draggableElements.push(element);\r\n        element.setAttribute(\"dragging\", '1');\r\n        if (zoomCompensation) {\r\n            offset.x = (e.pageX + $UI.viewport.scrollLeft)/(1+extraZoom/20) - element.offsetLeft;\r\n            offset.y = (e.pageY + $UI.viewport.scrollTop)/(1+extraZoom/20) - element.offsetTop;\r\n        } else {\r\n            offset.x = e.pageX - element.offsetLeft;\r\n            offset.y = e.pageY - element.offsetTop;\r\n        }\r\n        \r\n        if (pickupElement) { pickupElement(e, offset); }     \r\n    });\r\n\r\n    element.addEventListener(\"release\", function(e:CustomEvent<{event:MouseEvent}>) {\r\n        element.style.cursor = \"\";\r\n        element.style.userSelect = \"\";\r\n        draggableElements.splice(draggableElements.indexOf(element), 1);\r\n        if (dropElement) { dropElement(e.detail.event, offset); }\r\n    } as EventListener);\r\n\r\n    if (followMouse === true) {\r\n        if (moveElement !== undefined) {\r\n            element.addEventListener(\"followMouse\", function(e:CustomEvent<{event:MouseEvent}>) {\r\n                if (followCondition) { followCondition(doFollow, e.detail.event); }\r\n                if (followCondition ? doFollow[0] : true) {\r\n                    if (zoomCompensation) {\r\n                        element.style.left = ((e.detail.event.pageX + $UI.viewport.scrollLeft)/(1+extraZoom/20) - offset.x).toString()+\"px\";\r\n                        element.style.top = ((e.detail.event.pageY + $UI.viewport.scrollTop)/(1+extraZoom/20) - offset.y).toString()+\"px\";\r\n                    } else {\r\n                        element.style.left = (e.detail.event.pageX - offset.x).toString()+\"px\";\r\n                        element.style.top = (e.detail.event.pageY - offset.y).toString()+\"px\";\r\n                    }\r\n                    \r\n                    moveElement(e.detail.event, offset);\r\n                }\r\n            } as EventListener)\r\n        } else {\r\n            element.addEventListener(\"followMouse\", function(e:CustomEvent<{event:MouseEvent}>) {\r\n                if (followCondition) { followCondition(doFollow, e.detail.event); }\r\n                if (followCondition ? doFollow[0] : true) {\r\n                    if (zoomCompensation) {\r\n                        element.style.left = ((e.detail.event.pageX + $UI.viewport.scrollLeft)/(1+extraZoom/20) - offset.x).toString()+\"px\";\r\n                        element.style.top = ((e.detail.event.pageY + $UI.viewport.scrollTop)/(1+extraZoom/20) - offset.y).toString()+\"px\";\r\n                    } else {\r\n                        element.style.left = (e.detail.event.pageX - offset.x).toString()+\"px\";\r\n                        element.style.top = (e.detail.event.pageY - offset.y).toString()+\"px\";\r\n                    }\r\n                }\r\n            } as EventListener)\r\n        }    \r\n    }\r\n}\r\n\r\nlet draggingElement = false;\r\nwindow.addEventListener(\"mousemove\", (e) => {\r\n    draggingElement = false;\r\n    for (const element of draggableElements) {\r\n        if (element.getAttribute(\"dragging\") !== \"1\") { return; }\r\n        draggingElement = true;\r\n        element.dispatchEvent(new CustomEvent(\"followMouse\", {\r\n            \"detail\": {\"event\": e}\r\n        }));\r\n    }\r\n    if (draggingElement) { e.preventDefault(); }\r\n});\r\n\r\nwindow.addEventListener(\"mouseup\", (e) => {\r\n    if (e.button !== 0) return;\r\n    for (const element of draggableElements) {\r\n        if (element.getAttribute(\"dragging\")!==\"1\") continue;\r\n        element.setAttribute(\"dragging\", '0');\r\n        if (element.getAttribute(\"checkBlocker\") === \"true\") {\r\n            if (!CheckAntiBlockerPixel(e) && (!isDM || flag.playerMode)) {\r\n                element.style.cursor = \"\";\r\n                element.style.userSelect = \"\";\r\n                draggableElements.splice(draggableElements.indexOf(element), 1);\r\n                element.parentElement?.removeChild(element);\r\n                element.dispatchEvent(new CustomEvent(\"dragcancel\", {\r\n                    \"detail\": {\"event\": e}\r\n                }));\r\n                return;\r\n            }    \r\n        }\r\n        element.dispatchEvent(new CustomEvent(\"release\", {\"detail\": {\"event\": e}}));\r\n    }\r\n});\r\n//#endregion\r\n\r\n//#region Custom zoom\r\nlet extraZoom = 0;\r\nwindow.addEventListener(\"wheel\", (e) => {\r\n    if (!e.ctrlKey && !e.metaKey) { return; }\r\n    e.preventDefault();\r\n    if (e.deltaY<0) {\r\n        extraZoom+=1;\r\n        $UI.board.style.transform = \"scale(\"+(1+extraZoom/20).toString()+\")\";\r\n        $UI.viewport.scrollLeft = $UI.viewport.scrollLeft*((20+extraZoom)/(20+extraZoom-1));\r\n        $UI.viewport.scrollTop = $UI.viewport.scrollTop*((20+extraZoom)/(20+extraZoom-1));\r\n        e.preventDefault();\r\n    }\r\n    if (e.deltaY>0) {\r\n        extraZoom-=1;\r\n        $UI.board.style.transform = \"scale(\"+(1+extraZoom/20).toString()+\")\";\r\n        $UI.viewport.scrollLeft = $UI.viewport.scrollLeft/((20+extraZoom)/(20+extraZoom-1));\r\n        $UI.viewport.scrollTop = $UI.viewport.scrollTop/((20+extraZoom)/(20+extraZoom-1));\r\n        e.preventDefault();\r\n    }\r\n}, { passive: false });\r\n\r\nlet previousScrollHeight = $UI.initiativeTrackerDiv.scrollHeight;\r\nlet previousScrollTop = 0;\r\n$UI.initiativeTrackerDiv.onscroll = () => {\r\n    if ($UI.initiativeTrackerDiv.scrollHeight==previousScrollHeight) {\r\n        previousScrollTop = $UI.initiativeTrackerDiv.scrollTop * window.devicePixelRatio;\r\n    } else {\r\n        $UI.initiativeTrackerDiv.scrollTop = previousScrollTop / window.devicePixelRatio;\r\n        previousScrollHeight = $UI.initiativeTrackerDiv.scrollHeight;\r\n    }\r\n}\r\n//#endregion\r\n\r\n//#region Map options\r\n$UI.startGridAligner.onclick = () => {\r\n    if (flag.gridAlignMode) {\r\n        const vLinePos = getChildren($UI.vAlignHandles).map((e) => Number(e.style.left.slice(0, -2))).sort((a,b) => a-b);\r\n        const hLinePos = getChildren($UI.hAlignHandles).map((e) => Number(e.style.top.slice(0, -2))).sort((a,b) => a-b);\r\n        const offset = {\r\n            x: vLinePos[0],\r\n            y: hLinePos[0],\r\n        };\r\n        const vLineDistances = vLinePos.slice(1).map((p, i) => p - vLinePos[i]);\r\n        const hLineDistances = hLinePos.slice(1).map((p, i) => p - hLinePos[i]);\r\n        const xMean = vLineDistances.reduce((p, c) => p+c, 0) / vLineDistances.length;\r\n        const yMean = hLineDistances.reduce((p,c) => p+c, 0) / hLineDistances.length;\r\n        const squares = {\r\n            x: mapPreload.width / xMean,\r\n            y: mapPreload.height / yMean,\r\n        }\r\n        if (!isNaN(squares.x) && offset.x && confirm(`Apply new X settings?\\nX: ${squares.x} \\nOffset: ${offset.x}`)) {\r\n            socket.emit(\"setMapData\", {x: squares.x, offsetX: offset.x});\r\n            $UI.vAlignHandles.innerHTML = \"\";\r\n        }\r\n        if (!isNaN(squares.y) && offset.y && confirm(`Apply new Y settings?\\nY: ${squares.y} \\nOffset: ${offset.y}`)) {\r\n            socket.emit(\"setMapData\", {y: squares.y, offsetY: offset.y});\r\n            $UI.hAlignHandles.innerHTML = \"\";\r\n        }\r\n    }\r\n    flag.gridAlignMode = !flag.gridAlignMode;\r\n    updateButtonColors();\r\n}\r\n\r\n$UI.gridColorPicker.onchange = () => {\r\n    socket.emit(\"setMapData\", {gridColor: $UI.gridColorPicker.value as `#${string}`});\r\n}\r\n\r\n$UI.systemSelect.onchange = () => {\r\n    socket.emit(\"setMapData\", {system: $UI.systemSelect.value});\r\n}\r\n\r\n$UI.mapSelect.onchange = () => {\r\n    socket.emit(\"changeSelectedMap\", {selectedMap: $UI.mapSelect.value})\r\n}\r\n\r\n$UI.createNewMapButton.onclick = () => {\r\n    const mapName = prompt('Enter new map name:');\r\n    if (mapName === null) { return; }\r\n    socket.emit(\"createNewMap\", {name: mapName});\r\n}\r\n\r\n$UI.mapSourceSelect.onchange = () => {\r\n    socket.emit(\"setMapData\", {map: $UI.mapSourceSelect.value});\r\n}\r\n\r\n$UI.mapYInput.onchange = () => {\r\n    socket.emit(\"setMapData\", {y: parseFloat($UI.mapYInput.value)});\r\n}\r\n\r\n$UI.mapXInput.onchange = () => {\r\n    socket.emit(\"setMapData\", {x: parseFloat($UI.mapXInput.value)});\r\n}\r\n\r\n$UI.offsetXInput.onchange = () => {\r\n    socket.emit(\"setMapData\", {offsetX: parseFloat($UI.offsetXInput.value)});\r\n}\r\n\r\n$UI.offsetYInput.onchange = () => {\r\n    socket.emit(\"setMapData\", {offsetY: parseFloat($UI.offsetYInput.value)});\r\n}\r\n\r\n$UI.diagonalTypeSelect.onchange = () => {\r\n    socket.emit('setMapData', {diagonalMovement: $UI.diagonalTypeSelect.value});\r\n}\r\n//#endregion\r\n\r\n//#region Drawing functions\r\nfunction drawCanvas(skipMap?:boolean) {\r\n    draggableElements = draggableElements.filter((el) => document.body.contains(el));\r\n    $UI.polyBlockerHandles.innerHTML = '';\r\n    if (!skipMap) {\r\n        $UI.polyBlockers.setAttribute(\"width\", mapPreload.width.toString());\r\n        $UI.polyBlockers.setAttribute(\"height\", mapPreload.height.toString());\r\n        $UI.shapeMap.style.width = `${mapPreload.width}`;\r\n        $UI.shapeMap.style.height = `${mapPreload.height}`;\r\n        $UI.antiBlockerMap.width = mapPreload.width;\r\n        $UI.antiBlockerMap.height = mapPreload.height;\r\n        $UI.gridMap.width = mapPreload.width;\r\n        $UI.gridMap.height = mapPreload.height;\r\n        gridSize = {x: mapPreload.width/mapData.x, y: mapPreload.height/mapData.y, min:Math.min(mapPreload.width/mapData.x, mapPreload.height/mapData.y)};\r\n        $UI.mapImage.src = mapPreload.src;\r\n    }\r\n    drawGrid();\r\n    document.body.style.setProperty(\"--antiBlocker-color\", (isDM && !flag.playerMode)?\"#00000080\":\"#000000FF\");\r\n    document.body.style.setProperty(\"--blocker-color\", mapData.antiBlockerOn ? ((isDM && !flag.playerMode)?\"#00000080\":\"#000000FF\") : \"#00000000\");\r\n    antiBlockerContext.clearRect(0, 0, $UI.antiBlockerMap.width, $UI.antiBlockerMap.height);\r\n    if (mapData.antiBlockerOn) { drawAntiBlocker(); }\r\n    $UI.polyBlockers.innerHTML = '';\r\n    $UI.blockersDiv.innerHTML = \"\";\r\n    if (mapData.blockerType == 0) {\r\n        $UI.polyBlockerHandles.style.visibility = \"hidden\";\r\n        drawBlockers();\r\n    }\r\n    if (mapData.blockerType == 1) {\r\n        $UI.polyBlockerHandles.style.visibility = \"\";\r\n        drawPolyBlockers();\r\n    }\r\n    drawTokens();\r\n    drawShapes();\r\n    if (oldParsedData === undefined || JSON.stringify(oldParsedData.tokens) !== JSON.stringify(mapData.tokens)) {\r\n        console.log(\"First time or change detected!\");\r\n        updateTracker();\r\n    }\r\n}\r\n\r\nfunction drawShapes() {\r\n    $UI.shapeMap.innerHTML = '';\r\n    $UI.shapeHandles.innerHTML = \"\";\r\n    for (const currentShape of mapData.drawings) {\r\n        if (!currentShape.visible && (!isDM||flag.playerMode)) { continue; }\r\n        switch (currentShape.shape) {\r\n            case \"circle\":\r\n                drawCircle(currentShape);\r\n                break;\r\n            case \"square\":\r\n                drawSquare(currentShape);\r\n                break;\r\n            case \"cone\":\r\n                currentShape.is90Deg ? draw90Cone(currentShape) : drawCone(currentShape);\r\n                break;\r\n            case \"5ftLine\":\r\n                draw5Line(currentShape);\r\n                break;\r\n            case \"vertexLine\":\r\n                drawVertexLine(currentShape);\r\n                break;\r\n        }\r\n    }\r\n    updateHighlights();\r\n}\r\n\r\nfunction updateHighlightedShape() {\r\n    $UI.shapeHandles.innerHTML = \"\";\r\n    for (const shape of getChildren($UI.shapeMap)) {\r\n        shape.dispatchEvent(new Event('checkSelected'));\r\n    }\r\n}\r\n\r\nfunction drawVertexLine(shape:Shape) {\r\n    const vertexLine = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');\r\n    vertexLine.style.stroke = shape.trueColor;\r\n    vertexLine.style.strokeWidth = `${shapeWidth}`;\r\n    vertexLine.style.fill = `none`;\r\n    vertexLine.style.pointerEvents = 'none';\r\n    vertexLine.setAttribute('points', shape.verts.map((point) => `${point.x},${point.y}`).join(' '));\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = `${shapeWidth*3}`;\r\n    hitbox.style.fill = `none`;\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('points', shape.verts.map((point) => `${point.x},${point.y}`).join(' '));\r\n    vertexLine.addEventListener('checkSelected', () => {\r\n        if (selectedShapeId !== shape.id) { return; }\r\n        for (const point of shape.verts) {\r\n            const handleContainer = document.createElement(\"div\");\r\n            handleContainer.style.position = \"absolute\";\r\n            handleContainer.style.left = point.x.toString();\r\n            handleContainer.style.top = point.y.toString();\r\n            const handle = document.createElement(\"div\");\r\n            handle.className = \"shapeHandle\";\r\n            handle.draggable = true;\r\n            handle.style.left = \"-0.25vw\";\r\n            handle.style.top = \"-0.25vw\";\r\n            draggableElement(handle, true, undefined, (e) => {\r\n                if (((e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20)) === shape.x) { return; }\r\n                if (((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20)) === shape.y) { return; }\r\n                point.x = ((e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n                point.y = ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n                socket.emit(\"editDrawing\", {id: shape.id, verts: shape.verts});\r\n            }, undefined, true);\r\n    \r\n            handle.addEventListener(\"contextmenu\", (e) => {\r\n                e.preventDefault();\r\n                displayMenu(e, [\r\n                    {text: \"Remove vert\", hasSubMenu: false, callback: () => {\r\n                        socket.emit('removeVert', {type: 'line', id: shape.id, vertID: point.id});\r\n                    }}\r\n                ]);\r\n            });\r\n            handleContainer.appendChild(handle);\r\n            $UI.shapeHandles.appendChild(handleContainer);\r\n        }\r\n    })\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        if (e.button !== 0) return;\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = shape.id;\r\n        updateHighlights();\r\n        shapeDragOffset.x = shape.verts[0].x - ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        shapeDragOffset.y = shape.verts[0].y - ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        document.body.style.cursor = \"pointer\";\r\n        movingShapeId = shape.id;\r\n        flag.isMovingShape = true;\r\n    });\r\n\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Add vert\", hasSubMenu: false, callback: () => {\r\n                const vertX = (e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20);\r\n                const vertY = (e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20);\r\n                let previousPoint = shape.verts[0];\r\n                for (const [i, point] of Object.entries(shape.verts)) {\r\n                    if (i === '0') {continue;}\r\n                    const originX = Math.min(point.x, previousPoint.x);\r\n                    const originY = Math.min(point.y, previousPoint.y);\r\n                    const width = Math.abs(point.x-previousPoint.x);\r\n                    const height = Math.abs(point.y-previousPoint.y);\r\n                    if (vertX >= originX && vertX <= (originX+width) && vertY >= originY && vertY <= (originY+height)) {\r\n                        shape.verts.splice(Number(i), 0, {id: crypto.randomUUID(), x: vertX, y: vertY});\r\n                        break;\r\n                    }\r\n                    previousPoint = point;\r\n                }\r\n                socket.emit(\"editDrawing\", {id: shape.id, verts: shape.verts});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group ? shape.group.toString() : \"\");\r\n                if (shapeGroupString === null) {\r\n                    return;\r\n                }\r\n                if (shapeGroupString === '') {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }},\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(hitbox);\r\n    $UI.shapeMap.appendChild(vertexLine);\r\n}\r\n\r\nfunction drawCircle(shape:Shape) {\r\n    const trueRadius = shape.radius*gridSize.min;\r\n    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n    circle.style.stroke = shape.trueColor;\r\n    circle.style.strokeWidth = shapeWidth.toString();\r\n    circle.style.fill = 'none';\r\n    circle.style.pointerEvents = 'none';\r\n    circle.setAttribute('cx', shape.x.toString());\r\n    circle.setAttribute('cy', shape.y.toString());\r\n    circle.setAttribute('r', trueRadius.toString());\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = (shapeWidth*3).toString();\r\n    hitbox.style.fill = 'none';\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('cx', shape.x.toString());\r\n    hitbox.setAttribute('cy', shape.y.toString());\r\n    hitbox.setAttribute('r', trueRadius.toString());\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        if (e.button !== 0 || shape.link) return;\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        shapeDragOffset.x = shape.x - ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        shapeDragOffset.y = shape.y - ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        document.body.style.cursor = \"pointer\";\r\n        movingShapeId = shape.id;\r\n        flag.isMovingShape = true;\r\n    });\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group?.toString() ?? \"\");\r\n                if (shapeGroupString === null) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }}, {text: \"Edit radius\", hasSubMenu: false, callback: () => {\r\n                const currentToken = mapData.tokens.find((t) => t.id === shape.link);\r\n                let newRange = promptNumber(\"Please enter the new radius\", currentToken !== undefined ? (shape.radius - currentToken.size/2)*feetPerSquare : shape.radius*feetPerSquare);\r\n                if (newRange === null || isNaN(newRange)) { return; }\r\n                if (currentToken !== undefined) {\r\n                    newRange = newRange/feetPerSquare + currentToken.size/2;\r\n                } else {\r\n                    newRange = newRange/feetPerSquare;\r\n                }\r\n                socket.emit(\"editDrawing\", {radius: newRange, id: shape.id});\r\n            }}\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(circle);\r\n    $UI.shapeMap.appendChild(hitbox);\r\n}\r\n\r\nfunction drawSquare(shape:Shape) {\r\n    const square = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n    square.style.stroke = shape.trueColor;\r\n    square.style.strokeWidth = shapeWidth.toString();\r\n    square.style.fill = 'none';\r\n    square.style.pointerEvents = 'none';\r\n    square.setAttribute('width', shape.width.toString());\r\n    square.setAttribute('height', shape.height.toString());\r\n    square.setAttribute('x', shape.x.toString());\r\n    square.setAttribute('y', shape.y.toString());\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = (3*shapeWidth).toString();\r\n    hitbox.style.fill = 'none';\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('width', shape.width.toString());\r\n    hitbox.setAttribute('height', shape.height.toString());\r\n    hitbox.setAttribute('x', shape.x.toString());\r\n    hitbox.setAttribute('y', shape.y.toString());\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        if (e.button !== 0) return;\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        shapeDragOffset.x = shape.x - ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        shapeDragOffset.y = shape.y - ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        document.body.style.cursor = \"pointer\";\r\n        movingShapeId = shape.id;\r\n        flag.isMovingShape = true;\r\n    });\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group ? shape.group.toString() : \"\");\r\n                if (shapeGroupString === null) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }}\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(hitbox);\r\n    $UI.shapeMap.appendChild(square);\r\n}\r\n\r\nfunction draw5Line(shape:Shape) {\r\n    const linkedToken = mapData.tokens.find((t) => t.id === shape.link);\r\n    if (linkedToken === undefined) { console.error(\"Could not find token linked to 5ft line!\"); return; }\r\n    const lineOrigin = {x: Math.round(shape.x + Math.cos(shape.angle)*gridSize.x*0.5*linkedToken.size), y: Math.round(shape.y + Math.sin(shape.angle)*gridSize.y*0.5*linkedToken.size)};\r\n    const topOriginCorner = {x: Math.round(lineOrigin.x + Math.cos(shape.angle-0.5*Math.PI)*gridSize.x*0.5), y: Math.round(lineOrigin.y + Math.sin(shape.angle-0.5*Math.PI)*gridSize.y*0.5)};\r\n    const topTargetCorner = {x: Math.round(topOriginCorner.x + Math.cos(shape.angle) * shape.range * gridSize.x), y: Math.round(topOriginCorner.y + Math.sin(shape.angle) * shape.range * gridSize.y)};\r\n    const bottomOriginCorner = {x: Math.round(lineOrigin.x + Math.cos(shape.angle+0.5*Math.PI)*gridSize.x*0.5), y: Math.round(lineOrigin.y + Math.sin(shape.angle+0.5*Math.PI)*gridSize.y*0.5)};\r\n    const bottomTargetCorner = {x: Math.round(bottomOriginCorner.x + Math.cos(shape.angle) * shape.range * gridSize.x), y: Math.round(bottomOriginCorner.y + Math.sin(shape.angle) * shape.range * gridSize.y)};\r\n    const line5ft = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    line5ft.style.stroke = shape.trueColor;\r\n    line5ft.style.strokeWidth = shapeWidth.toString();\r\n    line5ft.style.fill = 'none';\r\n    line5ft.style.pointerEvents = 'none';\r\n    line5ft.setAttribute('d', `M ${topOriginCorner.x},${topOriginCorner.y} L ${bottomOriginCorner.x},${bottomOriginCorner.y} L ${bottomTargetCorner.x},${bottomTargetCorner.y} L ${topTargetCorner.x},${topTargetCorner.y} Z`);\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = (3*shapeWidth).toString();\r\n    hitbox.style.fill = 'none';\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('d', `M ${topOriginCorner.x},${topOriginCorner.y} L ${bottomOriginCorner.x},${bottomOriginCorner.y} L ${bottomTargetCorner.x},${bottomTargetCorner.y} L ${topTargetCorner.x},${topTargetCorner.y} Z`);\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        if (e.button !== 0) return;\r\n        document.body.style.cursor = \"pointer\";\r\n        shapeDragOffset.x = shape.x;\r\n        shapeDragOffset.y = shape.y;\r\n        shapeDragStartAngle = Math.atan2((((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - shapeDragOffset.y), (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - shapeDragOffset.x));\r\n        movingShapeId = shape.id;\r\n        flag.isMoving5ftLine = true;\r\n    });\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group ? shape.group.toString() : \"\");\r\n                if (shapeGroupString === null) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }}, {text: \"Edit range\", hasSubMenu: false, callback: () => {\r\n                let newRange = Number.parseFloat(prompt(\"Please enter the new range\", (shape.range*feetPerSquare).toString()) ?? \"\");\r\n                if (!isNaN(newRange)) {\r\n                    newRange = newRange/feetPerSquare;\r\n                    socket.emit(\"editDrawing\", {range: newRange, id: shape.id});\r\n                }\r\n            }}\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(line5ft);\r\n    $UI.shapeMap.appendChild(hitbox);\r\n}\r\n\r\nfunction drawCone(shape:Shape) {\r\n    const angle = shape.angle;\r\n    const linkedToken = returnToken(shape.link);\r\n    if (linkedToken === undefined) {\r\n        throw new Error(`Couldn't find token ${shape.link}! Cant link to shape ${shape.id}!`);\r\n    }\r\n    const originX = Math.round(shape.x + Math.cos(angle)*0.5*linkedToken.size*gridSize.x);\r\n    const originY = Math.round(shape.y +  Math.sin(angle)*0.5*linkedToken.size*gridSize.y);\r\n    const centerY = Math.round(originY + Math.sin(angle) * shape.range * gridSize.y);\r\n    const centerX = Math.round(originX + Math.cos(angle) * shape.range * gridSize.x);\r\n    const destX1 = Math.round(0.5*(-centerY + originY) + centerX);\r\n    const destY1 = Math.round(0.5*(centerX - originX) + centerY);\r\n    const destX2 = Math.round(0.5*(centerY - originY) + centerX);\r\n    const destY2 = Math.round(0.5*(-centerX + originX) + centerY);\r\n    const cone = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    cone.style.stroke = shape.trueColor;\r\n    cone.style.strokeWidth = shapeWidth.toString();\r\n    cone.style.fill = 'none';\r\n    cone.style.pointerEvents = 'none';\r\n    cone.setAttribute('d', `M ${originX},${originY} L ${destX1},${destY1} L ${destX2},${destY2} Z`);\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = (3*shapeWidth).toString();\r\n    hitbox.style.fill = 'none';\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('d', `M ${originX},${originY} L ${destX1},${destY1} L ${destX2},${destY2} Z`);\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        if (e.button !== 0) return;\r\n        document.body.style.cursor = \"pointer\";\r\n        shapeDragOffset.x = shape.x;\r\n        shapeDragOffset.y = shape.y;\r\n        shapeDragStartAngle = Math.atan2((((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - shapeDragOffset.y), (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - shapeDragOffset.x));\r\n        movingShapeId = shape.id;\r\n        flag.isMovingCone = true;\r\n    });\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group ? shape.group.toString() : \"\");\r\n                if (shapeGroupString === null) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }}, {text: \"Edit range\", hasSubMenu: false, callback: () => {\r\n                let newRange = Number.parseFloat(prompt(\"Please enter the new range\", (shape.range*feetPerSquare).toString()) ?? \"\");\r\n                if (!isNaN(newRange)) {\r\n                    newRange = newRange/feetPerSquare;\r\n                    socket.emit(\"editDrawing\", {range: newRange, id: shape.id});\r\n                }\r\n            }}\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(cone);\r\n    $UI.shapeMap.appendChild(hitbox);\r\n}\r\n\r\nfunction draw90Cone(shape:Shape) {\r\n    const angle = shape.angle;\r\n    const linkedToken = returnToken(shape.link);\r\n    if (linkedToken === undefined) {\r\n        throw new Error(`Couldn't find token ${shape.link}! Cant link to shape ${shape.id}!`);\r\n    }\r\n    const originX = Math.round(shape.x + Math.cos(angle)*0.5*linkedToken.size*gridSize.x);\r\n    const originY = Math.round(shape.y +  Math.sin(angle)*0.5*linkedToken.size*gridSize.y);\r\n    const destX1 = Math.round(originX + Math.cos(angle+0.25*Math.PI) * shape.range * gridSize.x);\r\n    const destY1 = Math.round(originY + Math.sin(angle+0.25*Math.PI) * shape.range * gridSize.y);\r\n    const destX2 = Math.round(originX + Math.cos(angle-0.25*Math.PI) * shape.range * gridSize.x);\r\n    const destY2 = Math.round(originY + Math.sin(angle-0.25*Math.PI) * shape.range * gridSize.y);\r\n    const extendedRange = Math.sqrt(Math.pow(destX1 - originX, 2) + Math.pow(destY1 - originY, 2));\r\n    const cone90 = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    cone90.style.stroke = shape.trueColor;\r\n    cone90.style.strokeWidth = shapeWidth.toString();\r\n    cone90.style.fill = 'none';\r\n    cone90.style.pointerEvents = 'none';\r\n    cone90.setAttribute('d', `M ${originX},${originY} L ${destX1},${destY1} A ${extendedRange},${extendedRange} 0 0,0 ${destX2},${destY2} Z`);\r\n    const hitbox = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    hitbox.style.stroke = '#00000001';\r\n    hitbox.style.strokeWidth = (3*shapeWidth).toString();\r\n    hitbox.style.fill = 'none';\r\n    hitbox.style.pointerEvents = 'painted';\r\n    hitbox.setAttribute('d', `M ${originX},${originY} L ${destX1},${destY1} A ${extendedRange},${extendedRange} 0 0,0 ${destX2},${destY2} Z`);\r\n    hitbox.addEventListener('mousedown', (e) => {\r\n        selectedToken = '0-0-0-0-0';\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"none\";\r\n        if (e.button !== 0) return;\r\n        document.body.style.cursor = \"pointer\";\r\n        shapeDragOffset.x = shape.x;\r\n        shapeDragOffset.y = shape.y;\r\n        shapeDragStartAngle = Math.atan2((((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - shapeDragOffset.y), (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - shapeDragOffset.x));\r\n        movingShapeId = shape.id;\r\n        flag.isMovingCone = true;\r\n    });\r\n    hitbox.addEventListener('contextmenu', (e) => {\r\n        e.preventDefault();\r\n        const contextMenuList:ContextMenuOption[] = [\r\n            {text: \"Erase shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeDrawing\", {id: shape.id});\r\n            }},\r\n            {text: \"Set shape group\", hasSubMenu: false, callback: () => {\r\n                const shapeGroupString = prompt(\"Enter shape group number: \", shape.group ? shape.group.toString() : \"\");\r\n                if (shapeGroupString === null) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: null});\r\n                    return;\r\n                }\r\n                const group = parseInt(shapeGroupString);\r\n                if (!isNaN(group)) {\r\n                    socket.emit(\"editDrawing\", {id: shape.id, group: group});\r\n                }\r\n            }}, {text: \"Edit range\", hasSubMenu: false, callback: () => {\r\n                let newRange = Number.parseFloat(prompt(\"Please enter the new range\", (shape.range*feetPerSquare).toString()) ?? \"\");\r\n                if (!isNaN(newRange)) {\r\n                    newRange = newRange/feetPerSquare;\r\n                    socket.emit(\"editDrawing\", {range: newRange, id: shape.id});\r\n                }\r\n            }}\r\n        ];\r\n        if (isDM) {\r\n            contextMenuList.push({text: shape.visible?\"Hide shape\":\"Reveal shape\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"editDrawing\", {id: shape.id, visible: !shape.visible});\r\n            }});\r\n        }\r\n        displayMenu(e, contextMenuList);\r\n    });\r\n    $UI.shapeMap.appendChild(cone90);\r\n    $UI.shapeMap.appendChild(hitbox);\r\n}\r\n\r\nfunction drawPolyBlockers() {\r\n    if (flag.isDraggingBlocker) { return; }\r\n    for (const currentPolyBlocker of mapData.polyBlockers) {\r\n        const newPolygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon') as unknown as HTMLElement;\r\n        newPolygon.style.position = \"absolute\";\r\n        newPolygon.setAttribute(\"points\", currentPolyBlocker.verts.map((v) => `${v.x},${v.y}`).join(' '));\r\n        newPolygon.setAttribute(\"class\", \"polyBlocker\");\r\n        newPolygon.addEventListener('checkSelected', () => {\r\n            if (currentPolyBlocker.id !== selectedBlocker) {\r\n                if (currentPolyBlocker.inactive && isDM && !flag.playerMode) {\r\n                    newPolygon.style.stroke = \"red\";\r\n                    newPolygon.style.strokeDasharray = \"4\";\r\n                } else {\r\n                    newPolygon.style.stroke = \"\";\r\n                    newPolygon.style.strokeDasharray = \"\";\r\n                }\r\n                return;\r\n            }\r\n            newPolygon.style.stroke = \"violet\";\r\n            newPolygon.style.strokeDasharray = \"4\";\r\n            for (const vert of currentPolyBlocker.verts) {\r\n                const editHandleContainer = document.createElement(\"div\");\r\n                editHandleContainer.style.position = \"absolute\";\r\n                editHandleContainer.style.left = vert.x.toString();\r\n                editHandleContainer.style.top = vert.y.toString();\r\n                editHandleContainer.title = currentPolyBlocker.verts.indexOf(vert).toString();\r\n                const editHandle = document.createElement(\"div\");\r\n                editHandle.className = \"polyBlockerHandle\";\r\n                editHandle.style.left = \"-0.35vw\";\r\n                editHandle.style.top = \"-0.35vw\";\r\n                \r\n                draggableElement(editHandle, true, undefined, (e) => {\r\n                    socket.emit(\"editVert\", {id: selectedBlocker, vertID: vert.id, x: ((e.pageX + $UI.viewport.scrollLeft)/(1+extraZoom/20)), y: ((e.pageY + $UI.viewport.scrollTop)/(1+extraZoom/20))});\r\n                })\r\n                editHandle.addEventListener(\"contextmenu\", (e) => {\r\n                    e.preventDefault();\r\n                    const menuOptions = [\r\n                        {text: \"Add new vert\", hasSubMenu: false, callback: () => {\r\n                            socket.emit(\"addVert\", {id: currentPolyBlocker.id, vertID: vert.id});\r\n                            updateHighlights();\r\n                        }},\r\n                        {text: \"Remove vert\", hasSubMenu: false, callback: () => {\r\n                            if (currentPolyBlocker.verts.length>3) {\r\n                                socket.emit(\"removeVert\", {type:'blocker', id: currentPolyBlocker.id, vertID: vert.id});\r\n                            } else {\r\n                                alert(\"There are too few verts in that poly blocker to remove one!\");\r\n                            }\r\n                        }}\r\n                    ];\r\n                    displayMenu(e, menuOptions);\r\n                });\r\n                editHandleContainer.appendChild(editHandle);\r\n                $UI.polyBlockerHandles.appendChild(editHandleContainer);\r\n            }\r\n        });\r\n        \r\n        if (!mapData.antiBlockerOn && !currentPolyBlocker.inactive) {\r\n            antiBlockerContext.beginPath();\r\n            antiBlockerContext.fillStyle = document.body.style.getPropertyValue(\"--antiBlocker-color\");\r\n            antiBlockerContext.moveTo(currentPolyBlocker.verts[0].x, currentPolyBlocker.verts[0].y);\r\n            for (const vert of currentPolyBlocker.verts) {\r\n                antiBlockerContext.lineTo(vert.x, vert.y);\r\n            }\r\n            antiBlockerContext.fill('nonzero');\r\n        }\r\n\r\n        $UI.polyBlockers.appendChild(newPolygon);\r\n        if (!isDM || flag.playerMode) {\r\n            if (currentPolyBlocker.inactive) {\r\n                newPolygon.style.pointerEvents = \"none\";\r\n                continue;\r\n            }\r\n            if (mapData.antiBlockerOn) {\r\n                newPolygon.style.pointerEvents = \"none\";\r\n                continue;\r\n            }\r\n            \r\n            newPolygon.addEventListener(\"contextmenu\", (e) => {\r\n                e.preventDefault();\r\n            });\r\n\r\n            draggableElement(newPolygon, false, (e) => {\r\n                flag.isPanning = true;\r\n                oldMousePos.x = e.pageX;\r\n                oldMousePos.y = e.pageY;\r\n                oldScrollPos.x = $UI.viewport.scrollLeft;\r\n                oldScrollPos.y = $UI.viewport.scrollTop;\r\n                document.body.style.cursor = \"grabbing\";\r\n            }, () => {\r\n                document.body.style.cursor = \"\";\r\n            });\r\n            continue;\r\n        }\r\n\r\n        if (!flag.blockerEditMode || flag.quickPolyBlockerMode) {\r\n            newPolygon.style.pointerEvents = \"none\"; \r\n            continue;\r\n        }\r\n\r\n        newPolygon.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        draggableElement(newPolygon, true, (e) => {\r\n            selectedBlocker = currentPolyBlocker.id;\r\n            selectedToken = '0-0-0-0-0';\r\n            selectedShapeId = '0-0-0-0-0';\r\n            polyDragOffset.x = ((e.pageX+ $UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n            polyDragOffset.y = ((e.pageY + $UI.viewport.scrollTop)/(1+extraZoom/20));\r\n            updateHighlights();\r\n        }, (e) => {\r\n            const moveX = -polyDragOffset.x + ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n            const moveY = -polyDragOffset.y + ((e.pageY+ $UI.viewport.scrollTop)/(1+extraZoom/20));\r\n            if (moveX!=0 && moveY!=0) {\r\n                socket.emit(\"movePolyBlocker\", {id: currentPolyBlocker.id, offsetX: moveX, offsetY: moveY});\r\n            }\r\n        }, (e) => {\r\n            newPolygon.setAttribute(\"transform\", \"matrix(1,0,0,1,\"+(-polyDragOffset.x + ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))).toString()+\", \"+(-polyDragOffset.y + ((e.pageY+ $UI.viewport.scrollTop)/(1+extraZoom/20))).toString()+\")\");\r\n        });\r\n\r\n        newPolygon.addEventListener(\"contextmenu\", (e) => {\r\n            e.preventDefault();\r\n            const menuOptions = [\r\n                {text: currentPolyBlocker.inactive ? \"Activate\" : \"Deactivate\", hasSubMenu: false, callback: () => {\r\n                    socket.emit(\"togglePolyBlocker\", {id: currentPolyBlocker.id});\r\n                }},\r\n                {text: \"Remove blocker\", hasSubMenu: false, callback: () => {\r\n                    selectedBlocker = '0-0-0-0-0';\r\n                    socket.emit(\"removePolyBlocker\", {id: currentPolyBlocker.id});\r\n                }}\r\n            ];\r\n            displayMenu(e, menuOptions);\r\n        });\r\n    }\r\n    updateHighlights();\r\n}\r\n\r\nfunction drawBlockers() {\r\n    if (flag.isDraggingBlocker) { return; }\r\n    for (const currentBlocker of mapData.blockers) {\r\n        const tmpBlocker = document.createElement(\"div\");\r\n        const extraBlocker = document.createElement(\"div\");\r\n        tmpBlocker.className = \"blocker\";\r\n        tmpBlocker.style.left = currentBlocker.x + \"px\";\r\n        tmpBlocker.style.top = currentBlocker.y + \"px\";\r\n        tmpBlocker.style.width = currentBlocker.width + \"px\";\r\n        tmpBlocker.style.height = currentBlocker.height + \"px\";\r\n        tmpBlocker.addEventListener('checkSelected', () => {\r\n            if (flag.blockerEditMode) {\r\n                tmpBlocker.style.outline = currentBlocker.id==selectedBlocker ? `0.3vh dashed ${blockerOutlineColor}` : '';\r\n                tmpBlocker.style.zIndex = currentBlocker.id==selectedBlocker ? '1002' : '1001';\r\n            } else {\r\n                tmpBlocker.style.zIndex = '';\r\n                tmpBlocker.style.outline = '';\r\n            }\r\n        })\r\n        if (!mapData.antiBlockerOn) {\r\n            antiBlockerContext.beginPath();\r\n            antiBlockerContext.fillStyle = document.body.style.getPropertyValue(\"--antiBlocker-color\");\r\n            antiBlockerContext.fillRect(currentBlocker.x, currentBlocker.y, currentBlocker.width, currentBlocker.height);\r\n        }\r\n        tmpBlocker.appendChild(extraBlocker);\r\n        $UI.blockersDiv.appendChild(tmpBlocker);\r\n        if (!isDM || flag.playerMode) {\r\n            tmpBlocker.addEventListener(\"contextmenu\", (e) => { e.preventDefault(); })\r\n\r\n            tmpBlocker.addEventListener(\"mousedown\", (e) => {\r\n                if (e.button !== 0) { return; }\r\n                flag.isPanning = true;\r\n                oldMousePos.x = (e.pageX/(1+extraZoom/20));\r\n                oldMousePos.y = (e.pageY/(1+extraZoom/20));\r\n                oldScrollPos.x =$UI.viewport.scrollLeft;\r\n                oldScrollPos.y =$UI.viewport.scrollTop;\r\n                document.body.style.cursor = \"grabbing\";\r\n            });\r\n\r\n            tmpBlocker.addEventListener(\"mousemove\", (e) => {\r\n                if (!flag.isPanning) { return; }\r\n                $UI.viewport.scrollLeft = oldScrollPos.x - ((e.pageX/(1+extraZoom/20)) - oldMousePos.x);\r\n                $UI.viewport.scrollTop = oldScrollPos.y - ((e.pageY/(1+extraZoom/20)) - oldMousePos.y);\r\n            });\r\n\r\n            if (mapData.antiBlockerOn) {\r\n                extraBlocker.style.pointerEvents=\"none\";\r\n                tmpBlocker.style.pointerEvents=\"none\";\r\n                continue;\r\n            }\r\n            extraBlocker.style.userSelect = \"none\";\r\n            tmpBlocker.style.userSelect = \"none\";\r\n            extraBlocker.draggable = false;\r\n            tmpBlocker.draggable = false;\r\n            continue;\r\n        }\r\n        extraBlocker.style.width = currentBlocker.width + \"px\";\r\n        extraBlocker.style.height = currentBlocker.height + \"px\";\r\n        if (!flag.blockerEditMode || flag.isPlacingBlocker) {\r\n            extraBlocker.style.pointerEvents=\"none\";\r\n            tmpBlocker.style.pointerEvents=\"none\";\r\n            continue;\r\n        }\r\n        extraBlocker.draggable = true;\r\n        tmpBlocker.style.resize = \"both\";\r\n        tmpBlocker.addEventListener(\"mousedown\", (e) => {\r\n            if (e.button !== 0) { return; }\r\n            selectedBlocker = currentBlocker.id;\r\n            selectedToken = '0-0-0-0-0';\r\n            selectedShapeId = '0-0-0-0-0';\r\n            updateHighlights();\r\n            drawShapes();\r\n        });\r\n\r\n        tmpBlocker.addEventListener(\"dragover\", (e) => { e.preventDefault(); });\r\n\r\n        tmpBlocker.addEventListener(\"contextmenu\", (e) => {\r\n            e.preventDefault();\r\n            selectedBlocker = currentBlocker.id;\r\n            selectedToken = '0-0-0-0-0';\r\n            selectedShapeId = '0-0-0-0-0';\r\n            updateHighlights();\r\n            displayMenu(e, [{text: \"Remove blocker\", hasSubMenu: false, callback: () => {\r\n                selectedBlocker = '0-0-0-0-0';\r\n                socket.emit(\"removeBlocker\", {id: currentBlocker.id});\r\n            }}]);\r\n        });\r\n\r\n        tmpBlocker.addEventListener(\"mouseup\", (e) => {\r\n            if (e.button !== 0) { return; }\r\n            flag.isDraggingBlocker = false;\r\n            extraBlocker.style.width = currentBlocker.width + \"px\";\r\n            extraBlocker.style.height = currentBlocker.height + \"px\";\r\n            if (currentBlocker.width === tmpBlocker.offsetWidth || currentBlocker.height === tmpBlocker.offsetHeight) { return; }\r\n            socket.emit(\"editBlocker\", {id: currentBlocker.id, x: currentBlocker.x, y: currentBlocker.y, width: tmpBlocker.offsetWidth, height: tmpBlocker.offsetHeight});\r\n        });\r\n\r\n        extraBlocker.addEventListener(\"dragstart\", (e) => {\r\n            flag.isDraggingBlocker = true;\r\n            blockerDragOffset.x = currentBlocker.x - ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n            blockerDragOffset.y = currentBlocker.y - ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        })\r\n\r\n        extraBlocker.addEventListener(\"dragend\", (e) => {\r\n            e.preventDefault();\r\n            if (!flag.isDraggingBlocker) { return; }\r\n            flag.isDraggingBlocker = false;\r\n            const newX = draggedBlocker.x + blockerDragOffset.x;\r\n            const newY = draggedBlocker.y + blockerDragOffset.y;\r\n            if (newX === currentBlocker.x || newY === currentBlocker.y) { return; }\r\n            socket.emit(\"editBlocker\", {id: currentBlocker.id, x: newX, y: newY, width: tmpBlocker.offsetWidth, height: tmpBlocker.offsetHeight});\r\n        })\r\n    }\r\n}\r\n\r\nfunction updateHighlightedBlocker() {\r\n    $UI.polyBlockerHandles.innerHTML = \"\";\r\n    for (const poly of getChildren($UI.polyBlockers)) {\r\n        poly.dispatchEvent(new Event('checkSelected'));\r\n    }\r\n\r\n    for (const blocker of getChildren($UI.blockersDiv)) {\r\n        blocker.dispatchEvent(new Event('checkSelected'));\r\n    }\r\n}\r\n\r\nfunction drawAntiBlocker() {\r\n    switch (mapData.blockerType) {\r\n        case 0:\r\n            antiBlockerContext.fillStyle = document.body.style.getPropertyValue(\"--antiBlocker-color\");\r\n            antiBlockerContext.fillRect(0, 0, mapPreload.width, mapPreload.height);\r\n            antiBlockerContext.globalCompositeOperation = \"destination-out\";\r\n            for (const blocker of mapData.blockers) {\r\n                antiBlockerContext.fillStyle = \"#FFFFFFFF\";\r\n                antiBlockerContext.fillRect(blocker.x, blocker.y, blocker.width, blocker.height);\r\n            }\r\n            antiBlockerContext.globalCompositeOperation = \"source-over\";\r\n            break;\r\n\r\n        case 1:\r\n            antiBlockerContext.fillStyle = document.body.style.getPropertyValue(\"--antiBlocker-color\");\r\n            antiBlockerContext.fillRect(0, 0, mapPreload.width, mapPreload.height);\r\n            antiBlockerContext.globalCompositeOperation = \"destination-out\";\r\n            for (const polyBlocker of mapData.polyBlockers) {\r\n                if (polyBlocker.inactive) { continue; }\r\n                antiBlockerContext.beginPath();\r\n                antiBlockerContext.fillStyle = \"#FFFFFFFF\";\r\n                antiBlockerContext.moveTo(polyBlocker.verts[0].x, polyBlocker.verts[0].y);\r\n                for (const vert of polyBlocker.verts) {\r\n                    antiBlockerContext.lineTo(vert.x, vert.y);\r\n                }\r\n                antiBlockerContext.fill();\r\n            }\r\n            antiBlockerContext.globalCompositeOperation = \"source-over\";\r\n            break;\r\n    }\r\n}\r\n\r\nfunction drawGrid() {\r\n    gridCanvas.strokeStyle = GridColor;\r\n    gridCanvas.lineWidth = GridLineWidth;\r\n    gridCanvas.clearRect(0, 0, mapPreload.width, mapPreload.height);\r\n    gridCanvas.beginPath();\r\n    if (!gridActive) { return; }\r\n    for (let x = -Math.round(mapPreload.width/gridSize.x); x <= Math.round(mapPreload.width/gridSize.x); x++) {\r\n        gridCanvas.moveTo(x * gridSize.x + offsetX + 0.5, 0);\r\n        gridCanvas.lineTo(x * gridSize.x + offsetX + 0.5, mapPreload.height);\r\n    }    \r\n    for (let y = -Math.round(mapPreload.height/gridSize.y); y <= Math.round(mapPreload.height/gridSize.y); y++) {\r\n        gridCanvas.moveTo(0, y * gridSize.y + offsetY + 0.5);\r\n        gridCanvas.lineTo(mapPreload.width, y * gridSize.y + offsetY + 0.5);\r\n    }\r\n    gridCanvas.stroke();\r\n}\r\n\r\nfunction LoadTokenData(token:Token, force?:boolean) {\r\n    if (!CheckTokenPermission(token)) {\r\n        $UI.detailsIcon.src = \"public/blankToken.png\";\r\n        $UI.nameInput.value = \"DM only!\";\r\n        $UI.maxHpInput.value = \"\";\r\n        $UI.currentHpInput.value = \"\";\r\n        $UI.statusInput.value = token.status ?? '';\r\n        $UI.initiativeInput.value = \"\";\r\n        $UI.groupIdInput.value = \"\";\r\n        $UI.acInput.value = \"\";\r\n        $UI.mentalDef.value = \"\";\r\n        $UI.physicalDef.value = \"\";\r\n        $UI.refDef.value = \"\";\r\n        $UI.fortDef.value = \"\";\r\n        $UI.willDef.value = \"\";\r\n        $UI.noteArea.value = \"\";\r\n        $UI.notesBoxTextArea.value = \"\";\r\n        DetailsToggleButtonsUpdate(false, false);\r\n        return;\r\n    }\r\n    notesTargetToken = token.id;\r\n    if (!token.image) {\r\n        $UI.detailsIcon.src = 'public/blankToken.png';\r\n    } else if (mapData.tokenList.includes(token.image)) {\r\n        $UI.detailsIcon.src = `public/tokens/${token.image}`;\r\n    } else if (mapData.dmTokenList.includes(token.image)) {\r\n        $UI.detailsIcon.src = `public/dmTokens/${token.image}`;\r\n    } else {\r\n        $UI.detailsIcon.src = \"public/blankToken.png\";\r\n    }\r\n\r\n    if (document.activeElement!=$UI.nameInput || force) { $UI.nameInput.value = token.name ?? \"\"; }\r\n    if (document.activeElement!=$UI.noteArea || force) { $UI.noteArea.value = token.notes ?? \"\"; }\r\n    if (document.activeElement!=$UI.notesBoxTextArea || force) { $UI.notesBoxTextArea.value = token.notes ?? \"\"; }\r\n    if (document.activeElement!=$UI.initiativeInput || force) { $UI.initiativeInput.value = token.initiative?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.acInput || force) { $UI.acInput.value = token.ac?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.mentalDef || force) { $UI.mentalDef.value = token.mentalDef?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.physicalDef || force) { $UI.physicalDef.value = token.physicalDef?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.refDef || force) { $UI.refDef.value = token.refDef?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.fortDef || force) { $UI.fortDef.value = token.fortDef?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.willDef || force) { $UI.willDef.value = token.willDef?.toString() ?? \"\"; }\r\n    if (document.activeElement!=$UI.statusInput || force) { $UI.statusInput.value = token.status ?? \"\"; }\r\n    if (document.activeElement!=$UI.groupIdInput || force) { $UI.groupIdInput.value = token.group?.toString() ?? \"\"; }\r\n    if ((document.activeElement!=$UI.currentHpInput && document.activeElement!=$UI.maxHpInput) || force) {\r\n        $UI.currentHpInput.value = token.hp?.split(\"/\")[0] ?? \"\";\r\n        $UI.maxHpInput.value = token.hp?.split(\"/\")[1] ?? \"\";\r\n    }\r\n    DetailsToggleButtonsUpdate(token.concentrating, token.hideTracker);\r\n}\r\n\r\nfunction drawTokens() {\r\n    $UI.tokensDiv.innerHTML = \"\";\r\n    for (const token of mapData.tokens) {\r\n        if (token.hidden && (!isDM || flag.playerMode)) { continue; }\r\n        drawToken(token);\r\n    }\r\n}\r\n\r\nfunction refreshToken(token:Token, oldContainer:HTMLElement) {\r\n    oldContainer.parentElement?.removeChild(oldContainer);\r\n    drawToken(token);\r\n}\r\n\r\nfunction drawToken(token:Token) {\r\n    const tokenContainer = document.createElement('div');\r\n    tokenContainer.style.top = `${token.y - (gridSize.y*token.size)/2}px`;\r\n    tokenContainer.style.left = `${token.x - (gridSize.x*token.size)/2}px`;\r\n    tokenContainer.style.width = `${token.size*gridSize.x - GridLineWidth}px`;\r\n    tokenContainer.style.height = `${token.size*gridSize.y - GridLineWidth}px`;\r\n    tokenContainer.style.position = \"absolute\";\r\n    tokenContainer.style.zIndex = `${Math.floor(token.layer*10) + baseTokenIndex}`;\r\n    tokenContainer.id = token.id;\r\n\r\n    const imageElement = document.createElement(\"img\");\r\n    imageElement.style.zIndex = `${Math.floor(token.layer*10) + baseTokenIndex}`;\r\n    imageElement.className = \"position-absolute w-100 h-100\";\r\n    if (!token.image) {\r\n        imageElement.src = 'public/blankToken.png';\r\n    } else if (mapData.tokenList.includes(token.image)) {\r\n        imageElement.src = `public/tokens/${token.image}`;\r\n    } else if (mapData.dmTokenList.includes(token.image)) {\r\n        imageElement.src = `public/dmTokens/${token.image}`;\r\n    } else {\r\n        imageElement.src = \"public/blankToken.png\";\r\n    }\r\n    imageElement.title = token.status ?? '';\r\n    tokenContainer.appendChild(imageElement);\r\n\r\n    if (flag.isPlacingCone || flag.isPlacingLine || flag.isPlacingSquare || flag.isDraggingBlocker || flag.quickPolyBlockerMode) { tokenContainer.style.pointerEvents = \"none\"; }\r\n\r\n    tokenContainer.addEventListener(\"mousemove\", (e) => {\r\n        if (!flag.isPanning) { return; }\r\n        $UI.viewport.scrollLeft = oldScrollPos.x - ((e.pageX/(1+extraZoom/20)) - oldMousePos.x);\r\n        $UI.viewport.scrollTop = oldScrollPos.y - ((e.pageY/(1+extraZoom/20)) - oldMousePos.y);\r\n    })\r\n\r\n    tokenContainer.addEventListener(\"dragover\", (e) => { e.preventDefault(); })\r\n\r\n    $UI.tokensDiv.appendChild(tokenContainer);\r\n\r\n    if (token.id === selectedToken) {\r\n        LoadTokenData(token);\r\n        updateHighlights();\r\n    }\r\n\r\n    let textHolder:HTMLDivElement;\r\n    if (!token.image) {\r\n        textHolder = document.createElement(\"div\");\r\n        textHolder.innerText = token.text;\r\n        textHolder.className = \"position-absolute top-50 start-50 translate-middle text-nowrap font-monospace text-dark\";\r\n        textHolder.style.zIndex = `${Math.floor(token.layer*10) + baseTokenIndex + 1}`;\r\n        tokenContainer.appendChild(textHolder);\r\n        textHolder.style.fontSize = `${Math.min(tokenContainer.offsetWidth, tokenContainer.offsetHeight)/token.text.length}`\r\n    }\r\n\r\n    let hiddenImage:HTMLImageElement;\r\n    if (token.hidden) {\r\n        hiddenImage = document.createElement(\"img\");\r\n        hiddenImage.src = \"images/hidden.png\";\r\n        hiddenImage.className = \"position-absolute top-0 start-0\";\r\n        hiddenImage.style.width = ((token.size * gridSize.x-GridLineWidth) / 3).toString() + \"px\";\r\n        hiddenImage.style.height = ((token.size * gridSize.y-GridLineWidth) / 3).toString() + \"px\";\r\n        hiddenImage.style.zIndex = (Math.floor(token.layer*10) + baseTokenIndex + 1).toString();\r\n        tokenContainer.appendChild(hiddenImage);\r\n    }    \r\n    \r\n    let concentratingIcon:HTMLImageElement;\r\n    if (token.concentrating && (!token.dm || (isDM&&!flag.playerMode))) {\r\n        concentratingIcon = document.createElement(\"img\");\r\n        concentratingIcon.className = \"position-absolute bottom-0 start-0\";\r\n        concentratingIcon.src = \"images/literally_copyright.png\";\r\n        tokenContainer.appendChild(concentratingIcon);\r\n        concentratingIcon.style.width = ((token.size * gridSize.x-GridLineWidth) / 3).toString() + \"px\";\r\n        concentratingIcon.style.height = ((token.size * gridSize.y-GridLineWidth) / 3).toString() + \"px\";\r\n        concentratingIcon.style.zIndex = (Math.floor(token.layer*10) + baseTokenIndex + 1).toString();\r\n    }\r\n\r\n    tokenContainer.addEventListener(\"contextmenu\", (e) => {\r\n        closeMenu();\r\n        closeSubMenu();\r\n        e.preventDefault();\r\n        if (!CheckAntiBlockerPixel(e) && (!isDM || flag.playerMode)) { return; }\r\n        const menuOptions:ContextMenuOption[] = [{text: \"Draw Shape\", hasSubMenu: true, callback: () => {\r\n            const subMenuOptions = [\r\n                {text: \"Draw Circle\", callback: () => {\r\n                    const radiusInput = promptNumber(\"Please enter the desired radius in feet for your circle(s)\");\r\n                    if (radiusInput === null || isNaN(radiusInput)) { return; }\r\n                    circleMarkers.radius = (radiusInput + (feetPerSquare / 2) * token.size) / feetPerSquare;\r\n                    socket.emit(\"addDrawing\", {shape: \"circle\", link: token.id, x: token.x, y: token.y, radius: circleMarkers.radius, trueColor: shapeColor, visible: isDM ? confirm(\"Should the shape be visible?\") : true});\r\n                    closeMenu();\r\n                    closeSubMenu();\r\n                }},\r\n                {text: \"Draw Cone\", callback: () => {\r\n                    const rangeInput = promptNumber(\"Please enter the desired range in feet for your cone\");\r\n                    if (rangeInput === null || isNaN(rangeInput)) { return; }\r\n                    coneMarkers.is90Deg = false;\r\n                    coneMarkers.x = token.x;\r\n                    coneMarkers.y = token.y;\r\n                    coneMarkers.range = rangeInput / feetPerSquare;\r\n                    coneMarkers.linkId = token.id;\r\n                    flag.isPlacingCone = true;\r\n                    drawCanvas();\r\n                }},\r\n                {text: \"Draw 90\u00B0 Cone\", callback: () => {\r\n                    const rangeInput = promptNumber(\"Please enter the desired range in feet for your cone\");\r\n                    if (rangeInput === null || isNaN(rangeInput)) { return; }\r\n                    coneMarkers.is90Deg = true;\r\n                    coneMarkers.x = token.x;\r\n                    coneMarkers.y = token.y;\r\n                    coneMarkers.range = rangeInput / feetPerSquare;\r\n                    coneMarkers.linkId = token.id;\r\n                    flag.isPlacingCone = true;\r\n                    drawCanvas();\r\n                }},\r\n                {text: \"Draw 5ft wide Line\", callback: () => {\r\n                    const rangeInput = promptNumber(\"Please enter the desired range of the line in feet.\\nThen click where you want to aim.\");\r\n                    if (rangeInput === null || isNaN(rangeInput)) { return; }\r\n                    thickLineMarkers.range = rangeInput / feetPerSquare;\r\n                    thickLineMarkers.x = token.x;\r\n                    thickLineMarkers.y = token.y;\r\n                    thickLineMarkers.linkId = token.id;\r\n                    flag.isPlacing5ftLine = true;\r\n                    drawCanvas();\r\n                }}\r\n            ];\r\n            displaySubMenu(e, subMenuOptions);\r\n        }}];\r\n        if ((token.dm && isDM) || !token.dm) {\r\n            menuOptions.unshift({text: \"Delete token\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"removeToken\", {id: token.id});\r\n                if (token.id !== selectedToken) { return; }\r\n                $UI.initiativeInput.value = \"\";\r\n                $UI.nameInput.value = \"\";\r\n                $UI.acInput.value = \"\";\r\n                $UI.mentalDef.value = \"\";\r\n                $UI.physicalDef.value = \"\";\r\n                $UI.refDef.value = \"\";\r\n                $UI.fortDef.value = \"\";\r\n                $UI.willDef.value = \"\";\r\n                $UI.currentHpInput.value = \"\";\r\n                $UI.maxHpInput.value = \"\";\r\n                $UI.statusInput.value = \"\";\r\n                $UI.groupIdInput.value = \"\";\r\n                selectedToken = '0-0-0-0-0';\r\n                DetailsToggleButtonsUpdate(false, false);\r\n            }});\r\n\r\n            menuOptions.push({text: \"Edit token\", hasSubMenu: true, callback: () => {\r\n                const subMenuOptions = [\r\n                    {text: \"Change size\", callback: () => {\r\n                        const tokenSize = promptNumber(\"Please enter the new size of the token\");\r\n                        if (tokenSize === null || isNaN(tokenSize)) { return; }\r\n                        if (tokenSize <= 0 || (!isDM && tokenSize > 6)) { alert(\"The desired size is too large or invalid\"); return; }\r\n                        socket.emit(\"editToken\", {id: token.id, size: tokenSize, layer: token.layer + token.size - tokenSize});\r\n                    }},\r\n                    {text: \"Change layer\", callback: () => {\r\n                        const newLayer = promptInteger(\"Please enter the new layer\", token.layer);\r\n                        if (newLayer === null || isNaN(newLayer)) { return; }\r\n                        if (newLayer<=0 || newLayer>499) { alert(\"Layer must be > 0 and < 500 \"); return; }\r\n                        socket.emit(\"editToken\", {id: token.id, layer: newLayer});\r\n                    }}\r\n                ];\r\n                if (token.text != null) {\r\n                    subMenuOptions.push({text: \"Edit text\", callback: () => {\r\n                        const newText = prompt(\"Please enter the new text for the token:\", token.text);\r\n                        if (newText===null) { return; }\r\n                        socket.emit(\"editToken\", {id: token.id, text: newText});\r\n                    }});\r\n                }\r\n                if (isDM) {\r\n                    subMenuOptions.push({text: \"Toggle DM only\", callback: () => {\r\n                        socket.emit(\"editToken\", {id: token.id, dm: !token.dm});\r\n                    }});\r\n                }\r\n                displaySubMenu(e, subMenuOptions);\r\n            }});\r\n\r\n            menuOptions.push({text: \"Change image\", hasSubMenu: true, callback: () => {\r\n                const subMenu = [];\r\n                subMenu.push({text: \"Text\", callback: () => {\r\n                    socket.emit(\"editToken\", {id: token.id, image: \"\", text: token.text?token.text:\"Text\"});\r\n                }});\r\n                for (const image of mapData.tokenList) {\r\n                    subMenu.push({text: image.substring(0, image.length - 4), callback: () => {\r\n                        socket.emit(\"editToken\", {id: token.id, image: image});\r\n                    }});\r\n                }\r\n                if (isDM) {\r\n                    for (const image of mapData.dmTokenList) {\r\n                        subMenu.push({text: image.substring(0, image.length - 4), callback: () => {\r\n                            socket.emit(\"editToken\", {id: token.id, image: image});\r\n                        }});\r\n                    }\r\n                }\r\n                displaySubMenu(e, subMenu);\r\n            }});\r\n        }\r\n        \r\n        if (isDM) {\r\n            menuOptions.push({text: token.hidden ? \"Reveal token\" : \"Hide token\", hasSubMenu: false, callback: () => {\r\n                socket.emit(\"setTokenHidden\", {id: token.id, hidden: !token.hidden});\r\n            }});\r\n            if (token.group !== undefined) {\r\n                menuOptions.push({text: \"Group options\", hasSubMenu: true, callback: () => {\r\n                    const subMenuOptions = [{text: \"Hide tokens\", callback: () => {\r\n                            for (const tmpToken of mapData.tokens) {\r\n                                if (tmpToken.group == token.group) {\r\n                                    socket.emit(\"setTokenHidden\", {id: tmpToken.id, hidden: true});\r\n                                }\r\n                            }\r\n                        }},\r\n                        {text: \"Reveal tokens\", callback: () => {\r\n                            for (const tmpToken of mapData.tokens) {\r\n                                if (tmpToken.group == token.group) {\r\n                                    socket.emit(\"setTokenHidden\", {id: tmpToken.id, hidden: false});\r\n                                }\r\n                            }\r\n                        }},\r\n                        {text: \"Hide trackers\", callback: () => {\r\n                            for (const tmpToken of mapData.tokens) {\r\n                                if (tmpToken.group == token.group) {\r\n                                    socket.emit(\"editToken\", {id: tmpToken.id, hideTracker: true});\r\n                                }\r\n                            }\r\n                            \r\n                        }},\r\n                        {text: \"Show trackers\", callback: () => {\r\n                            for (const tmpToken of mapData.tokens) {\r\n                                if (tmpToken.group == token.group) {\r\n                                    socket.emit(\"editToken\", {id: tmpToken.id, hideTracker: false});\r\n                                }\r\n                            }\r\n                            \r\n                        }},\r\n                        {text: \"Toggle DM only\", callback: () => {\r\n                            for (const tmpToken of mapData.tokens) {\r\n                                if (tmpToken.group == token.group) {\r\n                                    socket.emit(\"editToken\", {id: tmpToken.id, dm: !token.dm});\r\n                                }\r\n                            }\r\n                        }}\r\n                    ];\r\n                    displaySubMenu(e, subMenuOptions);\r\n                }});\r\n            }\r\n        }\r\n        displayMenu(e, menuOptions);\r\n    });\r\n\r\n    draggableElement(tokenContainer, true, (e) => {\r\n        if (e.ctrlKey || e.metaKey) { flag.controlPressed = true; }\r\n        selectedToken = token.id;\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        $UI.detailsScreen.style.display = \"\";\r\n        imageElement.style.opacity = \"0.7\";\r\n        if (concentratingIcon) { concentratingIcon.style.opacity = \"0.7\"; }   \r\n        if (textHolder) { textHolder.style.opacity = \"0.7\"; }\r\n        if (hiddenImage) { hiddenImage.style.opacity = \"0.7\"; }\r\n        flag.isPanning = false;\r\n    }, (e, offset) => {\r\n        if (flag.isPanning) {\r\n            flag.controlPressed = false;\r\n            document.body.style.cursor = \"\";\r\n            return;\r\n        }\r\n        const zoomAdjustedPos = {\r\n            x: (e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20),\r\n            y: (e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20),\r\n        }\r\n        const tokenCenter = {\r\n            x: 0.5 * gridSize.x * token.size,\r\n            y: 0.5 * gridSize.y * token.size,\r\n        }\r\n        if (!gridSnap) {\r\n            const tempx = zoomAdjustedPos.x - offset.x + tokenCenter.x;\r\n            const tempy = zoomAdjustedPos.y - offset.y + (token.size * gridSize.y)/2;\r\n            if (tempx === token.x && tempy === token.y) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n            if (!CheckAntiBlockerPixelPosition(tempx, tempy) && (!isDM || flag.playerMode)) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n            if (tempx < 0 || tempy < 0 || tempx > $UI.mapImage.offsetWidth || tempy > $UI.mapImage.offsetHeight) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n            socket.emit(\"moveToken\", {id: token.id, x: tempx, y: tempy, bypassLink: !flag.controlPressed});\r\n            flag.controlPressed = false;\r\n            return;\r\n        }\r\n        let tX;\r\n        let tY;\r\n        if (token.size >= 1) {\r\n            tX = Math.round((zoomAdjustedPos.x - offset.x - mapData.offsetX)/gridSize.x) * gridSize.x + tokenCenter.x + offsetX + GridLineWidth;\r\n            tY = Math.round((zoomAdjustedPos.y - offset.y - mapData.offsetY)/gridSize.y) * gridSize.y + tokenCenter.y + offsetY + GridLineWidth;\r\n        } else {\r\n            tX = Math.round((zoomAdjustedPos.x - mapData.offsetX - tokenCenter.x) / (gridSize.x * token.size)) * (gridSize.x * token.size) + tokenCenter.x + offsetX + GridLineWidth;\r\n            tY = Math.round((zoomAdjustedPos.y - mapData.offsetY - tokenCenter.y) / (gridSize.y * token.size)) * (gridSize.y * token.size) + tokenCenter.y + offsetY + GridLineWidth;\r\n        }\r\n        \r\n        if (tX === token.x && tY === token.y) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n        if (!CheckAntiBlockerPixelPosition(tX, tY) && (!isDM || flag.playerMode)) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n        if (tX < 0 || tY < 0 || tX > $UI.mapImage.offsetWidth || tY > $UI.mapImage.offsetHeight) { flag.controlPressed = false; refreshToken(token, tokenContainer); return; }\r\n        socket.emit(\"moveToken\", {id: token.id, x: tX, y: tY, bypassLink: !flag.controlPressed});\r\n        flag.controlPressed = false;\r\n    }, undefined, true, (doFollow) => {\r\n        doFollow[0] = !flag.isPanning;\r\n    });\r\n    tokenContainer.addEventListener('dragcancel', () => {\r\n        refreshToken(token, tokenContainer);\r\n    })\r\n}\r\n\r\nfunction updateHighlightedToken() {\r\n    for (const token of getChildren($UI.tokensDiv)) {\r\n        token.style.outline = token.id===selectedToken?\"0.15vw dashed aqua\":\"\";\r\n    }       \r\n}\r\n\r\nlet previousInitiativeTrackerScrollPosition = 0;\r\nfunction updateTracker() {\r\n    previousInitiativeTrackerScrollPosition = $UI.initiativeTrackerDiv.scrollTop;\r\n    $UI.initiativeTrackerDiv.innerHTML = \"\";\r\n    for (const token of mapData.tokens) {\r\n        if (CheckTokenPermission(token) && !token.hideTracker) {\r\n            if ($UI.initSearch.value!=\"\") {\r\n                if (token.name ? (token.name.toLowerCase().includes($UI.initSearch.value.toLowerCase()) || !token.dm) : false)\r\n                    createTracker(token);\r\n                continue;\r\n            }\r\n            createTracker(token);\r\n        }\r\n    }\r\n    $UI.initiativeTrackerDiv.scrollTop = previousInitiativeTrackerScrollPosition;\r\n}\r\n\r\nlet isDraggingTracker = false;\r\nfunction createTracker(trackerData:Token) {\r\n    if (trackerData.initiative == null && trackerData.name == null && trackerData.ac == null && trackerData.hp == null) { return; }\r\n    const initiativeItem = document.createElement(\"div\");\r\n    initiativeItem.id = trackerData.id;\r\n    initiativeItem.className = \"d-flex gap-1 p-2 border border-dark-subtle rounded\";\r\n    initiativeItem.draggable = true;\r\n    initiativeItem.addEventListener(\"drop\", (e) => {\r\n        if (isDraggingTracker) {\r\n            if (e.dataTransfer?.getData(\"trackerId\") !== trackerData.id) {\r\n                socket.emit(\"switchTrackerPosition\", {origin: e.dataTransfer?.getData(\"trackerId\") as ID, target: trackerData.id});\r\n            }\r\n            isDraggingTracker = false;\r\n        }\r\n    });\r\n    initiativeItem.addEventListener(\"dblclick\", () => {\r\n       getChildren($UI.tokensDiv).find((e) => e.id === trackerData.id)?.scrollIntoView({behavior: \"smooth\", block: \"center\", inline: \"center\"});\r\n    });\r\n\r\n    initiativeItem.addEventListener(\"dragstart\", (e) => {\r\n        e.dataTransfer?.setData('trackerId', trackerData.id);\r\n        isDraggingTracker = true;\r\n    });\r\n    initiativeItem.addEventListener(\"dragend\", () => {\r\n        isDraggingTracker = false;\r\n    })\r\n    initiativeItem.addEventListener(\"dragover\", (e) => {\r\n        e.preventDefault();\r\n    });\r\n    initiativeItem.addEventListener(\"contextmenu\", (e) => {\r\n        e.preventDefault();\r\n    });\r\n    initiativeItem.addEventListener(\"click\", (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        $UI.detailsScreen.style.display = \"\";\r\n        selectedToken = trackerData.id;\r\n        selectedBlocker = '0-0-0-0-0';\r\n        selectedShapeId = '0-0-0-0-0';\r\n        updateHighlights();\r\n        LoadTokenData(trackerData);\r\n    });\r\n    initiativeItem.insertAdjacentHTML('beforeend', `\r\n    <div class=\"flex-shrink-1\">\r\n        <div class=\"d-flex align-items-center bg-body border rounded h-100\">\r\n            <span id=\"initIcon\" class=\"p-2\" style=\"cursor: pointer;\"><i class=\"bi-clock\"></i></span>\r\n            <div class=\"border-start h-100\"></div>\r\n            <span class=\"p-2 text-center align-self-center\"/>${trackerData.initiative ?? \"\"}</span>\r\n        </div>\r\n    </div>\r\n    <div class=\"flex-grow-1\">\r\n        <div class=\"d-flex align-items-center bg-body border rounded h-100\">\r\n            <span class=\"p-2\"><i class=\"bi-person-fill\"></i></span>\r\n            <div class=\"border-start h-100\"></div>\r\n            <span class=\"p-2 text-center text-break\">${trackerData.name ?? \"\"}</span>\r\n        </div>\r\n    </div>\r\n    <div class=\"flex-shrink-1\">\r\n        <div class=\"d-flex align-items-center bg-body border rounded h-100\">\r\n            <span class=\"p-2\" id=\"heartIcon\" style=\"cursor: pointer;\"><i class=\"bi-heart-fill text-danger\"></i></span>\r\n            <div class=\"border-start h-100\"></div>\r\n            <span class=\"p-2 text-center\">${trackerData.hp?.split('/')[0] ?? \"\"}</span>\r\n            <div class=\"border-start h-100\"></div>\r\n            <span class=\"p-2 text-center\">${trackerData.hp?.split('/')[1] ?? \"\"}</span>\r\n        </div>\r\n    </div>\r\n    <div class=\"flex-shrink-1\">\r\n        <div class=\"d-flex align-items-center bg-body border rounded h-100\">\r\n            <span class=\"p-2\"><i class=\"bi-shield-shaded\"></i></span>\r\n            <div class=\"border-start h-100\"></div>\r\n            <span class=\"p-2 text-center\">${trackerData.ac ?? \"\"}</span>\r\n        </div>\r\n    </div>\r\n    `);\r\n    const initIcon = initiativeItem.querySelector('#initIcon')!;\r\n    initIcon.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        socket.emit('changeTurn', {id: mapData.currentTurn !== trackerData.id ? trackerData.id : '0-0-0-0-0'});\r\n    });\r\n\r\n    const hpIcon = initiativeItem.querySelector('#heartIcon')!;\r\n    hpIcon.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const damage = promptInteger(\"Enter the damage to deal to this token: \");\r\n        if (damage === null || isNaN(damage)) { return; }\r\n        if (trackerData.hp == null) { return; }\r\n        const [minHP, maxHP] = trackerData.hp.split('/').map((h) => Number.parseFloat(h));\r\n        socket.emit(\"editToken\", {id: trackerData.id, hp: `${minHP - damage}/${maxHP}`});\r\n    });\r\n    initiativeItem.setAttribute(\"id\", trackerData.id);\r\n    initiativeItem.setAttribute(\"dm\", trackerData.dm.toString());\r\n    $UI.initiativeTrackerDiv.appendChild(initiativeItem);\r\n    updateHighlights();\r\n}\r\n\r\nfunction updateHighlightedTracker() {\r\n    if (selectedToken === \"0-0-0-0-0\") {\r\n        $UI.detailsScreen.style.display = \"none\";\r\n    }\r\n    for (const currentInitTracker of getChildren($UI.initiativeTrackerDiv)) {\r\n        if (currentInitTracker.tagName==\"DIV\") {\r\n            if (currentInitTracker.id === selectedToken) {\r\n                currentInitTracker.scrollIntoView();\r\n                currentInitTracker.style.background = currentInitTracker.getAttribute(\"dm\") === \"true\" ? \"#a14b28\" : \"#3b3b96\";\r\n            } else {\r\n                currentInitTracker.style.background = currentInitTracker.getAttribute(\"dm\") === \"true\" ? \"#614d45\" : \"#424254\";\r\n            }\r\n            if (currentInitTracker.id === mapData.currentTurn) {\r\n                currentInitTracker.classList.remove('border-dark-subtle');\r\n                currentInitTracker.classList.add('border-warning');\r\n            } else {\r\n                currentInitTracker.classList.remove('border-warning');\r\n                currentInitTracker.classList.add('border-dark-subtle');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction DetailsToggleButtonsUpdate(concentrating:boolean|undefined, hide:boolean|undefined) {\r\n    $UI.concentratingInput.style.backgroundColor = concentrating ? getComputedStyle(document.body).getPropertyValue(\"--toggle-highlighted-color\") : \"\";\r\n    ($UI.hideTrackerInput.children[0] as HTMLImageElement).src = hide ? \"images/visibility_off-24px.svg\" : \"images/visibility-24px.svg\";\r\n    $UI.hideTrackerInput.style.backgroundColor = hide ? getComputedStyle(document.body).getPropertyValue(\"--toggle-highlighted-color\") : \"\";\r\n}\r\n//#endregion\r\n\r\n//#region Menu events\r\nfunction SyncSideMenu() {\r\n    $UI.sideMenuCollapse.style.display = sideMenuExpanded ? \"\" : \"none\";\r\n    $UI.sideMenuToggleIcon.classList.toggle('bi-arrow-bar-left', !sideMenuExpanded);\r\n    $UI.sideMenuToggleIcon.classList.toggle('bi-arrow-bar-right', sideMenuExpanded);\r\n    $UI.viewport.style.width = `calc(100% - ${$UI.sideMenu.offsetWidth}px)`;\r\n    $UI.sideMenuToggle.style.right = sideMenuExpanded ? `${$UI.sideMenu.offsetWidth}px` : '0px';\r\n}\r\n\r\n$UI.sideMenuToggle.onclick = () => {\r\n    sideMenuExpanded = !sideMenuExpanded;\r\n    SyncSideMenu();\r\n}\r\n\r\n$UI.sortTracker.onclick = () => {\r\n    socket.emit(\"sortTracker\");\r\n}\r\n\r\n$UI.initSearch.oninput = () => {\r\n    updateTracker(); \r\n}\r\n\r\n$UI.bulkTokenConfirm.onclick = () => {\r\n    flag.isPlacingBulkOrigin = true;\r\n}\r\n//#endregion\r\n\r\n//#region Side buttons\r\n$UI.toggleGrid.oncontextmenu = (e) => {\r\n    e.preventDefault();\r\n    $UI.startGridAligner.click();\r\n}\r\n\r\n$UI.toggleGrid.onclick = () => {\r\n    gridActive = !gridActive;\r\n    drawGrid();\r\n    updateButtonColors();\r\n}\r\n\r\n$UI.toggleSnap.onclick = () => {\r\n    gridSnap = !gridSnap;\r\n    updateButtonColors();\r\n}\r\n\r\n$UI.quickPolyButton.onclick = () => {\r\n    if (isDM) {\r\n        if (flag.quickPolyBlockerMode) {\r\n            if(confirm(\"Add the new blocker?\") && newPolyBlockerVerts.length>2)\r\n                socket.emit(\"addCustomPolyBlocker\", {newPolyBlockerVerts: newPolyBlockerVerts});\r\n            flag.quickPolyBlockerMode = false;\r\n            newPolyBlockerVerts = [];\r\n            DrawNewPolyMarkers();\r\n        } else {\r\n            flag.quickPolyBlockerMode = true;\r\n            drawCanvas();\r\n        }\r\n    }\r\n    updateButtonColors();\r\n}\r\n\r\nlet displayMapSettings = false;\r\n$UI.toggleSettings.onclick = () => {\r\n    displayMapSettings = !displayMapSettings;\r\n    updateButtonColors();\r\n}\r\n\r\n$UI.mapOptionsMenuClose.onclick = () => {\r\n    displayMapSettings = false;\r\n    updateButtonColors();\r\n}\r\n\r\ndraggableElement($UI.mapOptionsMenuBox, true, undefined, undefined, undefined, undefined, undefined, $UI.mapOptionsMenuBody, false);\r\n\r\nlet displayColorPicker = false;\r\n$UI.colorPickerButton.onclick = () => {\r\n    displayColorPicker = !displayColorPicker;\r\n    updateButtonColors();\r\n}\r\n\r\n$UI.toggleBlockerEditing.onclick = () => {\r\n    flag.blockerEditMode = !flag.blockerEditMode;\r\n    drawCanvas();\r\n    updateButtonColors();\r\n}\r\n//#endregion\r\n\r\n//#region Color picker\r\n$UI.redSlider.oninput = updateColorPreview;\r\n$UI.greenSlider.oninput = updateColorPreview;\r\n$UI.blueSlider.oninput = updateColorPreview;\r\n$UI.opacitySlider.oninput = updateColorPreview;\r\n\r\n$UI.redSlider.oninput = updateColor;\r\n$UI.greenSlider.onchange = updateColor;\r\n$UI.blueSlider.onchange = updateColor;\r\n$UI.opacitySlider.onchange = updateColor;\r\n\r\nfunction componentToHex(c:number, isAlpha?:boolean) {\r\n    if (isAlpha) {\r\n        c = Math.floor(c*255);\r\n    }\r\n    const hex = c.toString(16);\r\n    return hex.length == 1 ? \"0\" + hex : hex;\r\n}\r\n  \r\nfunction rgbaToHex(r:number, g:number, b:number, a:number):`#${string}` {\r\n    return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}${componentToHex(a, true)}`;\r\n}\r\n\r\nfunction hexToRgba(hex:`#${string}`) {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? {\r\n        r: parseInt(result[1], 16),\r\n        g: parseInt(result[2], 16),\r\n        b: parseInt(result[3], 16),\r\n        a: parseInt(result[4], 16),\r\n    } : {\r\n        r: 0,\r\n        g: 0,\r\n        b: 0,\r\n        a: 0,  \r\n    };\r\n}\r\n\r\nfunction setColor(hexValue:`#${string}`) {\r\n    shapeColor = hexValue;\r\n    const components = hexToRgba(hexValue);\r\n    $UI.redSlider.value = components.r.toString();\r\n    $UI.greenSlider.value = components.g.toString();\r\n    $UI.blueSlider.value = components.b.toString();\r\n    $UI.opacitySlider.value = (components.a/255).toString();\r\n    $UI.colorPickerButton.style.backgroundColor = \"rgba(\"+$UI.redSlider.value+\",\"+$UI.greenSlider.value+\",\"+$UI.blueSlider.value+\",\"+$UI.opacitySlider.value+\")\";\r\n}\r\n\r\nfunction updateColorPreview() {\r\n    $UI.colorPickerButton.style.backgroundColor = \"rgba(\"+$UI.redSlider.value+\",\"+$UI.greenSlider.value+\",\"+$UI.blueSlider.value+\",\"+$UI.opacitySlider.value+\")\";\r\n}\r\n\r\nfunction updateColor() {\r\n    shapeColor = rgbaToHex(parseInt($UI.redSlider.value), parseInt($UI.greenSlider.value), parseInt($UI.blueSlider.value), parseFloat($UI.opacitySlider.value));\r\n    $UI.colorPickerButton.style.backgroundColor = \"rgba(\"+$UI.redSlider.value+\",\"+$UI.greenSlider.value+\",\"+$UI.blueSlider.value+\",\"+$UI.opacitySlider.value+\")\";\r\n    setCookie(\"shapeColor\", shapeColor);\r\n}\r\n//#endregion\r\n\r\n//#region Details menu\r\ndraggableElement($UI.notesBox, true, undefined, undefined, undefined, undefined, undefined, $UI.notesBoxTextArea, false);\r\n\r\n$UI.hpIcon.onclick = () => {\r\n    updateSelectedTokenData();\r\n    const damage = promptInteger(\"Enter the damage to deal to this token: \");\r\n    if (damage === null || isNaN(damage)) { return; }\r\n    if (selectedTokenData.hp == null) { return; }\r\n    const [minHP, maxHP] = selectedTokenData.hp.split('/').map((h) => Number.parseFloat(h));\r\n    socket.emit(\"editToken\", {id: selectedTokenData.id, hp: `${minHP - damage}/${maxHP}`});\r\n}\r\n\r\nlet notesTargetToken : ID;\r\nlet noteData : Token;\r\n$UI.noteArea.oninput = () => {\r\n    noteData = mapData.tokens.find((t) => t.id === notesTargetToken) ?? noteData;\r\n    if (CheckTokenPermission(noteData)) {\r\n        socket.emit(\"editToken\", {id: notesTargetToken, notes: $UI.noteArea.value});\r\n    }\r\n}\r\n\r\n$UI.notesBoxTextArea.oninput = () => {\r\n    noteData = mapData.tokens.find((t) => t.id === notesTargetToken) ?? noteData;\r\n    if (CheckTokenPermission(noteData)) {\r\n        socket.emit(\"editToken\", {id: notesTargetToken, notes: $UI.notesBoxTextArea.value});\r\n    }\r\n}\r\n\r\n$UI.initiativeInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newInit = Number.parseFloat($UI.initiativeInput.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, initiative: !isNaN(newInit) ? newInit : null});\r\n    }\r\n}\r\n\r\n$UI.nameInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, name: $UI.nameInput.value});\r\n    }\r\n}\r\n\r\n$UI.acInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.acInput.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, ac: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.refDef.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.refDef.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, refDef: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.fortDef.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.fortDef.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, fortDef: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.willDef.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.willDef.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, willDef: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.mentalDef.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.mentalDef.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, mentalDef: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.physicalDef.oninput = () => {\r\n    updateSelectedTokenData();\r\n    const newAC = Number.parseFloat($UI.physicalDef.value);\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, physicalDef: !isNaN(newAC) ? newAC : null});  \r\n    }\r\n}\r\n\r\n$UI.currentHpInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, hp: `${Number($UI.currentHpInput.value)}/${Number($UI.maxHpInput.value)}`});\r\n    }\r\n}\r\n\r\n$UI.maxHpInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, hp: `${Number($UI.currentHpInput.value)}/${Number($UI.maxHpInput.value)}`});\r\n    }\r\n}\r\n\r\n$UI.statusInput.oninput = () => {\r\n    updateSelectedTokenData();\r\n    socket.emit(\"editToken\", {id: selectedToken, status: $UI.statusInput.value});\r\n}\r\n\r\n$UI.groupIdInput.oninput = () => {\r\n    const newGroupId = Number.parseInt($UI.groupIdInput.value);\r\n    updateSelectedTokenData();\r\n    if (CheckTokenPermission(selectedTokenData)) {\r\n        socket.emit(\"editToken\", {id: selectedToken, group: !isNaN(newGroupId) ? newGroupId : null});\r\n    }    \r\n}\r\n\r\n$UI.hideTrackerInput.onclick = () => {\r\n    updateSelectedTokenData();\r\n    socket.emit(\"editToken\", {id: selectedToken, hideTracker: !selectedTokenData.hideTracker});\r\n}\r\n\r\n$UI.concentratingInput.onclick = () => {\r\n    updateSelectedTokenData();\r\n    socket.emit(\"editToken\", {id: selectedToken, concentrating: !selectedTokenData.concentrating});\r\n}\r\n//#endregion\r\n\r\n//#region DM Menu\r\n$UI.clearTokens.onclick = () => {\r\n    if (confirm(\"Do you really want to remove all the tokens?\") && isDM) {\r\n        socket.emit(\"clearTokens\");\r\n    }\r\n}\r\n\r\n$UI.clearDrawings.onclick = () => {\r\n    if (confirm(\"Do you really want to remove all the drawings?\") && isDM) {\r\n        socket.emit(\"clearDrawings\");\r\n    }\r\n}\r\n\r\n$UI.clearBlockers.onclick = () => {\r\n    if (confirm(\"Do you really want to remove all the blockers?\") && isDM) {\r\n        socket.emit(\"clearBlockers\");\r\n    }\r\n}\r\n\r\n$UI.blockerTypeSelect.onchange = () => {\r\n    if (confirm(\"Are you sure you want to switch blocker types?\") && isDM) {\r\n        flag.quickPolyBlockerMode = false;\r\n        $UI.quickPolyButton.style.display = $UI.blockerTypeSelect.value === '1' ? \"\" : \"none\";\r\n        socket.emit(\"switchBlockerType\", {type: Number.parseFloat($UI.blockerTypeSelect.value)});\r\n    }\r\n}\r\n\r\n$UI.invertBlockers.onclick = () => {\r\n    if (confirm(\"Do you really want to invert the blockers?\") && isDM) {\r\n        socket.emit(\"invertBlockers\");\r\n    }\r\n}\r\n\r\n$UI.togglePlayerMode.onclick = () => {\r\n    flag.playerMode = !flag.playerMode;\r\n    updateButtonColors();\r\n    $UI.shapeMap.style.zIndex = flag.playerMode ? \"\" : '941';\r\n    baseTokenIndex = flag.playerMode ? 0 : 500;\r\n    drawCanvas();\r\n}\r\n//#endregion\r\n\r\n//#region Main event handlers\r\nfunction updateHighlights() {\r\n    updateHighlightedBlocker();\r\n    updateHighlightedShape();\r\n    updateHighlightedToken();\r\n    updateHighlightedTracker();\r\n}\r\n\r\nfunction CheckAntiBlockerPixel(e:MouseEvent) {\r\n    if (mapData.antiBlockerOn) {\r\n        return antiBlockerContext.getImageData(Math.round((e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20)), Math.round((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20)), 1, 1, ).data[3] == 0;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction CheckAntiBlockerPixelPosition(x:number, y:number) {\r\n    const pixel = antiBlockerContext.getImageData(x, y, 1, 1).data;\r\n    return pixel[3] == 0;\r\n}\r\n\r\nfunction updateSelectedTokenData() {\r\n    selectedTokenData = mapData.tokens.find((token) => token.id === selectedToken) ?? selectedTokenData;\r\n}\r\n\r\nfunction CheckTokenPermission(token:Token) {\r\n    if (token==null)\r\n        return false;\r\n    if (token.dm!=null)\r\n        return !(!isDM && token.dm);\r\n    else {\r\n        if (token.image!=null)\r\n            return isDM || mapData.tokenList.includes(token.image);\r\n    }\r\n}\r\n\r\nfunction DrawNewPolyMarkers(activateMousedown?:boolean) {\r\n    $UI.newPolyBlockerHandles.innerHTML = \"\";\r\n    for (const [j, vert] of newPolyBlockerVerts.entries()) {\r\n        const editHandleContainer = document.createElement(\"div\");\r\n        editHandleContainer.style.position = \"absolute\";\r\n        editHandleContainer.style.left = vert.x.toString();\r\n        editHandleContainer.style.top = vert.y.toString();\r\n        const editHandle = document.createElement(\"div\");\r\n        editHandle.className = \"newPolyBlockerHandle\";\r\n        editHandle.style.left = \"-0.35vw\";\r\n        editHandle.style.top = \"-0.35vw\";\r\n        editHandle.title = (j+1).toString();\r\n        \r\n        editHandle.addEventListener(\"contextmenu\", (e) => {\r\n            e.preventDefault();\r\n            const menuOptions = [\r\n                {text: \"Remove vert\", hasSubMenu: false, callback: () => {\r\n                    newPolyBlockerVerts.splice(j, 1);\r\n                    DrawNewPolyMarkers();\r\n                }}\r\n            ];\r\n            displayMenu(e, menuOptions);\r\n        });\r\n\r\n        draggableElement(editHandleContainer, true, undefined, (e) => {\r\n            if (((e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20))!=vert.x && ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20))!=vert.y) {\r\n                vert.x = (e.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20);\r\n                vert.y = (e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20);\r\n                DrawNewPolyMarkers();\r\n            }\r\n        })\r\n\r\n        editHandle.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        editHandleContainer.appendChild(editHandle);\r\n        $UI.newPolyBlockerHandles.appendChild(editHandleContainer);\r\n        if (j==newPolyBlockerVerts.length-1 && activateMousedown) {\r\n            editHandle.dispatchEvent(new Event('mousedown'));\r\n        }\r\n    }\r\n}\r\n\r\nwindow.addEventListener(\"mousedown\", (e) => {\r\n    if (e.button !== 1) return;\r\n    e.preventDefault();\r\n    if (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))>0 && ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))<mapPreload.width && ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))>0 && ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))<mapPreload.height) {\r\n        socket.emit(\"requestPing\", {pingX: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)), pingY: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))});\r\n    }\r\n});\r\n\r\nwindow.addEventListener(\"mouseup\", (e) => {\r\n    if (e.button !== 0) return;\r\n    document.body.style.cursor = \"\";\r\n    flag.isPanning = false;\r\n    updateHighlights();\r\n\r\n    if (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))<0 || ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) > mapPreload.width || ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))<0 || ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) > mapPreload.height) {\r\n        flag.isMovingShape = false;\r\n        flag.isMovingCone = false;\r\n        flag.isMoving5ftLine = false;\r\n        return;\r\n    }\r\n    if (flag.isMovingShape) {\r\n        flag.isMovingShape = false;\r\n        if (CheckAntiBlockerPixelPosition(((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) + shapeDragOffset.x, ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) + shapeDragOffset.y) || (isDM&&!flag.playerMode)) {\r\n            socket.emit(\"editDrawing\", {id: movingShapeId, x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) + shapeDragOffset.x, y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) + shapeDragOffset.y, both: true, moveShapeGroup: (e.ctrlKey || e.metaKey)});\r\n            movingShapeId = '0-0-0-0-0'\r\n        }\r\n        return;\r\n    }\r\n\r\n    if (flag.isMovingCone) {\r\n        const movingShapeData = mapData.drawings.find((s) => s.id === movingShapeId);\r\n        if (movingShapeData === undefined) {\r\n            throw new Error(`Shape ${movingShapeId} is missing!`);\r\n        }\r\n        flag.isMovingCone = false;\r\n        let angle = movingShapeData.angle + (Math.atan2((((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - shapeDragOffset.y), (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - shapeDragOffset.x)) - shapeDragStartAngle);\r\n        if (angle<0) {\r\n            angle+=2*Math.PI;\r\n        }\r\n        socket.emit(\"editDrawing\", {id: movingShapeId, angle: angle});\r\n        return;\r\n    }\r\n\r\n    if (flag.isMoving5ftLine) {\r\n        const movingShapeData = mapData.drawings.find((s) => s.id === movingShapeId);\r\n        if (movingShapeData === undefined) {\r\n            throw new Error(`Shape ${movingShapeId} is missing!`);\r\n        }\r\n        flag.isMoving5ftLine = false;\r\n        let angle = movingShapeData.angle + (Math.atan2((((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - shapeDragOffset.y), (((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - shapeDragOffset.x)) - shapeDragStartAngle);\r\n        if (angle<0)\r\n            angle+=2*Math.PI;\r\n        socket.emit(\"editDrawing\", {id: movingShapeId, angle: angle});\r\n        return;\r\n    }\r\n});\r\n\r\ndocument.body.addEventListener(\"keydown\", (e) => {\r\n    if ((e.code.includes(\"Numpad\") && document.activeElement?.tagName!=\"INPUT\" && document.activeElement?.tagName!=\"TEXTAREA\") || (e.code.includes(\"Numpad\") && isNaN(parseInt(e.key))))\r\n        e.preventDefault();\r\n    \r\n    if (e.ctrlKey || e.metaKey) {\r\n        switch(e.code) {\r\n            case \"Digit0\":\r\n                extraZoom = 0;\r\n                break;\r\n            case \"Minus\":\r\n                extraZoom-=1;\r\n                $UI.board.style.transform = \"scale(\"+(1+extraZoom/20).toString()+\")\";\r\n                $UI.viewport.scrollLeft =$UI.viewport.scrollLeft/((1+extraZoom/20)/(1+(extraZoom-1)/20));\r\n                $UI.viewport.scrollTop =$UI.viewport.scrollTop/((1+extraZoom/20)/(1+(extraZoom-1)/20));\r\n                e.preventDefault();\r\n                break;\r\n            case \"Equal\":\r\n                extraZoom+=1;\r\n                $UI.board.style.transform = \"scale(\"+(1+extraZoom/20).toString()+\")\";\r\n                $UI.viewport.scrollLeft =$UI.viewport.scrollLeft*((20+extraZoom)/(20+extraZoom-1));\r\n                $UI.viewport.scrollTop =$UI.viewport.scrollTop*((20+extraZoom)/(20+extraZoom-1));\r\n                e.preventDefault();\r\n                break;\r\n        }\r\n    }\r\n});\r\n\r\ndocument.body.addEventListener(\"keyup\", (e) => {\r\n    if ((document.activeElement?.tagName!=\"INPUT\" && document.activeElement?.tagName!=\"TEXTAREA\") || (e.code.includes(\"Numpad\") && isNaN(parseInt(e.key))) || (e.altKey && e.code==\"KeyH\")) {\r\n        e.preventDefault();\r\n        let tX;\r\n        let tY;\r\n        switch (e.code) {\r\n            case \"Numpad8\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x*selectedTokenData.size)) * (gridSize.x*selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - gridSize.y*selectedTokenData.size - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y*selectedTokenData.size)) * (gridSize.y*selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY>0 && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n            \r\n            case \"Numpad7\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x - gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x - gridSize.x*selectedTokenData.size - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x*selectedTokenData.size)) * (gridSize.x*selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - gridSize.y*selectedTokenData.size - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y*selectedTokenData.size)) * (gridSize.y*selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY>0 && tX>0 && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n        \r\n            case \"Numpad9\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x + gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x + (gridSize.x * selectedTokenData.size) - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - (gridSize.y * selectedTokenData.size) - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY>0 && tX < mapPreload.width && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n\r\n            case \"Numpad4\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x - gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x - (gridSize.x * selectedTokenData.size) - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tX>0 && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n        \r\n            case \"Numpad6\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x + gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x + (gridSize.x * selectedTokenData.size) - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tX < mapPreload.width && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n            \r\n            case \"Numpad2\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + (gridSize.y * selectedTokenData.size) - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY<mapPreload.height && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n            \r\n            case \"Numpad1\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x - gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x - (gridSize.x * selectedTokenData.size) - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + (gridSize.y * selectedTokenData.size) - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY<mapPreload.height && tX>0 && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n        \r\n            case \"Numpad3\":\r\n                updateSelectedTokenData();\r\n                if (selectedTokenData.size >= 1) {\r\n                    tX = Math.round((selectedTokenData.x + gridSize.x - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/gridSize.x) * gridSize.x + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + gridSize.y - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/gridSize.y) * gridSize.y + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                } else {\r\n                    tX = Math.round((selectedTokenData.x + (gridSize.x * selectedTokenData.size) - mapData.offsetX - 0.5 * gridSize.x * selectedTokenData.size)/(gridSize.x * selectedTokenData.size)) * (gridSize.x * selectedTokenData.size) + 0.5 * gridSize.x * selectedTokenData.size + offsetX + GridLineWidth;\r\n                    tY = Math.round((selectedTokenData.y + (gridSize.y * selectedTokenData.size) - mapData.offsetY - 0.5 * gridSize.y * selectedTokenData.size)/(gridSize.y * selectedTokenData.size)) * (gridSize.y * selectedTokenData.size) + 0.5 * gridSize.y * selectedTokenData.size + offsetY + GridLineWidth;\r\n                }\r\n                if (tY<mapPreload.height && tX < mapPreload.width && (CheckAntiBlockerPixelPosition(tX, tY) || (isDM && !flag.playerMode))) {\r\n                    socket.emit(\"moveToken\", {id: selectedToken, x: tX, y: tY, bypassLink: !(e.ctrlKey || e.metaKey)});\r\n                }\r\n                break;\r\n\r\n            case \"KeyC\":\r\n                $UI.colorPickerButton.click();\r\n                break;\r\n\r\n            case \"KeyG\":\r\n                gridActive = !gridActive;\r\n                updateButtonColors();\r\n                drawGrid();\r\n                break;\r\n            \r\n            case \"KeyS\":\r\n                gridSnap = !gridSnap;\r\n                updateButtonColors();\r\n                break;\r\n\r\n            case \"KeyM\":\r\n                if (isDM)\r\n                    $UI.togglePlayerMode.click();\r\n                break;\r\n\r\n            case \"KeyB\":\r\n                if (isDM) {\r\n                    flag.blockerEditMode = !flag.blockerEditMode;\r\n                    updateButtonColors();\r\n                    drawCanvas();\r\n                }\r\n                break;\r\n\r\n            case \"KeyP\":\r\n                if (isDM && (mapData.blockerType==1))\r\n                    $UI.quickPolyButton.click();\r\n            break;\r\n\r\n            case \"KeyH\":\r\n                if (e.altKey)\r\n                    $UI.hpIcon.click();\r\n                break;\r\n\r\n            case \"Delete\":\r\n                if (isDM) {\r\n                    if (selectedToken !== '0-0-0-0-0') {\r\n                        socket.emit(\"removeToken\", {id: selectedToken});\r\n                        selectedToken = '0-0-0-0-0';\r\n                        return;\r\n                    }\r\n                    if (selectedBlocker !== '0-0-0-0-0') {\r\n                        socket.emit(mapData.blockerType==1 ? \"removePolyBlocker\" : \"removeBlocker\", {id: selectedBlocker});\r\n                        selectedBlocker = '0-0-0-0-0';\r\n                        return;\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    }\r\n});\r\n\r\ndraggableElement($UI.bulkTokenBox, true, undefined, undefined, undefined, undefined, undefined, $UI.bulkTokenBoxBody, false);\r\n\r\n$UI.bulkTokenRollEach.oninput = () => {\r\n    if ($UI.bulkTokenRollEach.checked) {\r\n        $UI.bulkTokenRollOnce.checked = false;\r\n    }        \r\n}\r\n\r\n$UI.bulkTokenRollOnce.oninput = () => {\r\n    if ($UI.bulkTokenRollOnce.checked) {\r\n        $UI.bulkTokenRollEach.checked = false;\r\n    }\r\n}\r\n\r\n$UI.bulkTokenInit.oninput = () => {\r\n    $UI.bulkTokenRollOnce.disabled = $UI.bulkTokenInit.value !== \"\";\r\n    $UI.bulkTokenRollEach.disabled = $UI.bulkTokenInit.value !== \"\";\r\n    if ($UI.bulkTokenInit.value !== \"\") {\r\n        $UI.bulkTokenRollEach.checked = false;\r\n        $UI.bulkTokenRollOnce.checked = false;\r\n    }\r\n}\r\n\r\nfunction placeBulkOrigin(e:MouseEvent) {\r\n    const bulkSettings = {\r\n        image: $UI.bulkTokenImageSelect.value,\r\n        name: $UI.bulkTokenNameInput.value,\r\n        amount: Number.parseInt($UI.bulkTokenAmountInput.value),\r\n        size: Number.parseFloat($UI.bulkTokenSize.value),\r\n        group: Number.parseFloat($UI.bulkTokenGroup.value),\r\n        hp: Number.parseFloat($UI.bulkTokenHP.value),\r\n        ac: Number.parseFloat($UI.bulkTokenAC.value),\r\n        fixedInit: Number.parseFloat($UI.bulkTokenInit.value),\r\n        dex: Number($UI.bulkTokenDex.value),\r\n        hideToken: $UI.bulkTokenHideToken.checked,\r\n        hideTracker: $UI.bulkTokenHideTracker.checked,\r\n        rollOnce: $UI.bulkTokenRollOnce.checked,\r\n        rollEach: $UI.bulkTokenRollEach.checked,\r\n    }\r\n    if (isNaN(bulkSettings.amount)) {\r\n        alert(\"Missing amount of tokens!\");\r\n        return;\r\n    }\r\n    if (isNaN(bulkSettings.size)) {\r\n        alert(\"Missing token size!\");\r\n        return;\r\n    }\r\n    const origin = {\r\n        x: (e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20),\r\n        y: (e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20),\r\n    }\r\n    let tokenInit;\r\n    if (bulkSettings.rollOnce) {\r\n        tokenInit = Math.ceil(Math.random()*20) + bulkSettings.dex;\r\n    }\r\n    if (!bulkSettings.rollEach && !bulkSettings.rollOnce && !isNaN(bulkSettings.fixedInit)) {\r\n        tokenInit = bulkSettings.fixedInit;\r\n    }\r\n    for (let f = 0; f < bulkSettings.amount; f++) {\r\n        if (bulkSettings.rollEach) {\r\n            tokenInit = Math.ceil(Math.random()*20) + bulkSettings.dex;\r\n        }\r\n        const tokenPos = {\r\n            x: origin.x + (f % Math.ceil(Math.sqrt(bulkSettings.amount))) * bulkSettings.size * gridSize.x,\r\n            y: origin.y + (Math.floor(f / Math.ceil(Math.sqrt(bulkSettings.amount)))) * bulkSettings.size * gridSize.y,\r\n        }\r\n        socket.emit(\"createToken\", {\r\n            text: bulkSettings.name !== \"\" ? `${bulkSettings.name} ${f+1}` : (f+1).toString(),\r\n            image: bulkSettings.image !== \"number\" ? bulkSettings.image : undefined,\r\n            x: tokenPos.x,\r\n            y: tokenPos.y,\r\n            size: bulkSettings.size,\r\n            layer: 50-bulkSettings.size,\r\n            dm: true,\r\n            name: bulkSettings.name ? `${bulkSettings.name} ${f+1}` : (f+1).toString(),\r\n            initiative: bulkSettings.rollEach || bulkSettings.rollOnce || bulkSettings.fixedInit !== undefined ? tokenInit : undefined,\r\n            hidden: bulkSettings.hideToken,\r\n            group: !isNaN(bulkSettings.group) ? bulkSettings.group : undefined,\r\n            hideTracker: bulkSettings.hideTracker,\r\n            hp: !isNaN(bulkSettings.hp) ? `${bulkSettings.hp}/${bulkSettings.hp}` : undefined,\r\n            ac: !isNaN(bulkSettings.ac) ? bulkSettings.ac : undefined,\r\n        });\r\n    }\r\n    flag.isPlacingBulkOrigin = false;\r\n}\r\n\r\n$UI.mapImage.addEventListener(\"mousedown\", (e) => {\r\n    if (e.button !== 0) return;\r\n    selectedToken = '0-0-0-0-0';\r\n    selectedBlocker = '0-0-0-0-0';\r\n    selectedShapeId = '0-0-0-0-0';\r\n    updateHighlights();\r\n    $UI.detailsScreen.style.display = \"none\";\r\n    \r\n    if (flag.isPlacingBulkOrigin) { placeBulkOrigin(e); }\r\n\r\n    if (flag.quickPolyBlockerMode) {\r\n        newPolyBlockerVerts.push({x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)), y: ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20))});\r\n        DrawNewPolyMarkers(true);\r\n        return;\r\n    }\r\n\r\n    if (flag.isPlacingSquare) {\r\n        flag.isPlacingSquare = false;\r\n        squareMarkers.width = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - squareMarkers.x;\r\n        squareMarkers.height = ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - squareMarkers.y;\r\n        if (Math.abs(squareMarkers.width) > mapPreload.width || Math.abs(squareMarkers.height) > mapPreload.height) {\r\n            alert(\"That square was too large or too small\");\r\n            return;\r\n        }   \r\n        if (!CheckAntiBlockerPixel(e) && (!isDM || flag.playerMode)) { return; }\r\n        socket.emit(\"addDrawing\", {shape: \"square\", x: squareMarkers.x, y: squareMarkers.y, width: squareMarkers.width, height: squareMarkers.height, trueColor: shapeColor, visible: isDM ? confirm(\"Should the shape be visible?\") : true});\r\n        return;\r\n    }\r\n\r\n    if (flag.isPlacingBlocker) {\r\n        flag.isPlacingBlocker = false;\r\n        if (!isDM) { return; }\r\n        blockerMarkers.width = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)) - blockerMarkers.x;\r\n        blockerMarkers.height = ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)) - blockerMarkers.y;\r\n        socket.emit(\"addBlocker\", {x: blockerMarkers.x, y: blockerMarkers.y, width: blockerMarkers.width, height: blockerMarkers.height});\r\n        return;\r\n    }\r\n    if (flag.isPlacingLine) {\r\n        lineMarkers.destX = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        lineMarkers.destY = ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        if ((isDM&&!flag.playerMode) || CheckAntiBlockerPixel(e)) {\r\n            let shapeIsVisible = true;\r\n            if (isDM)\r\n                shapeIsVisible = confirm(\"Should the shape be visible?\");\r\n            socket.emit(\"addDrawing\", {shape: \"vertexLine\", verts:[{x: lineMarkers.x, y: lineMarkers.y}, {x: lineMarkers.destX, y: lineMarkers.destY}], trueColor: shapeColor, visible: shapeIsVisible});\r\n        }\r\n        \r\n        flag.isPlacingLine = false;\r\n        return;\r\n    }\r\n    if (flag.isPlacing5ftLine) {\r\n        const destX = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        const destY = ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        let angle = Math.atan2((destY - thickLineMarkers.y), (destX - thickLineMarkers.x));\r\n        if (angle<0) { angle+=2*Math.PI; }\r\n        if ((isDM&&!flag.playerMode) || CheckAntiBlockerPixel(e)) {\r\n            let shapeIsVisible = true;\r\n            if (isDM)\r\n                shapeIsVisible = confirm(\"Should the shape be visible?\");\r\n            socket.emit(\"addDrawing\", {shape: \"5ftLine\", x: thickLineMarkers.x, y: thickLineMarkers.y, angle: angle, trueColor: shapeColor, link: thickLineMarkers.linkId, range: thickLineMarkers.range, visible: shapeIsVisible});\r\n        }\r\n        \r\n        flag.isPlacing5ftLine = false;\r\n        return;\r\n    }\r\n    if (flag.isPlacingCone) {\r\n        const destX = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        const destY = ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n        let angle = Math.atan2((destY - coneMarkers.y), (destX - coneMarkers.x));\r\n        if (angle<0) { angle+=2*Math.PI; }\r\n        if ((isDM&&!flag.playerMode) || CheckAntiBlockerPixel(e))\r\n            socket.emit(\"addDrawing\", {shape: \"cone\", link: coneMarkers.linkId, x: coneMarkers.x, y: coneMarkers.y, angle: angle, range: coneMarkers.range, trueColor: shapeColor, visible: isDM ? confirm(\"Should the shape be visible?\") : true, is90Deg: coneMarkers.is90Deg});\r\n        \r\n        flag.isPlacingCone = false;\r\n        return;\r\n    }\r\n    flag.isPanning = true;\r\n    oldMousePos.x = e.pageX;\r\n    oldMousePos.y = e.pageY;\r\n    oldScrollPos.x =$UI.viewport.scrollLeft;\r\n    oldScrollPos.y =$UI.viewport.scrollTop;\r\n    document.body.style.cursor = \"grabbing\";\r\n});\r\n\r\nwindow.addEventListener(\"mousemove\", (e) => {\r\n    if (!flag.isPanning) { return; }\r\n    $UI.viewport.scrollLeft = oldScrollPos.x + oldMousePos.x - e.pageX;\r\n    $UI.viewport.scrollTop = oldScrollPos.y + oldMousePos.y - e.pageY;\r\n});\r\n\r\n$UI.mapImage.addEventListener(\"dragstart\", (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n});\r\n\r\n$UI.mapImage.addEventListener(\"contextmenu\", (e) => {\r\n    e.preventDefault();\r\n    if (!flag.isPanning) {\r\n        if (CheckAntiBlockerPixel(e) || (isDM&&!flag.playerMode)) {\r\n            displayContextMenu(e);\r\n        } else {\r\n            closeMenu();\r\n            closeSubMenu();\r\n        }\r\n    }\r\n});\r\n\r\nfunction displayContextMenu(e:MouseEvent) {\r\n    const listOptions:ContextMenuOption[] = [\r\n        {text: \"Place Token\", hasSubMenu: true, callback: () => {\r\n            const subMenu = new Array<SubContextMenuOption>();\r\n            const tokenList = mapData.tokenList;\r\n            const dmTokenList = mapData.dmTokenList;\r\n            subMenu.push({text: \"Text token\", callback: () => {\r\n                const textToDisplay = prompt(\"Enter the text to display on the text token:\") ?? '';\r\n                const tokenSize = Number.parseFloat(prompt(\"Please enter the size of the token\") ?? \"\");\r\n                if (isNaN(tokenSize)) {\r\n                    alert(\"That wasn't a valid size!\"); return; \r\n                }\r\n                if (isDM && (tokenSize > 49  || tokenSize <= 0)) {\r\n                    alert(\"The desired size is too large or invalid\"); return;\r\n                }\r\n                if (!isDM && (tokenSize > 6 || tokenSize <= 0)) {\r\n                    alert(\"That token size isn't allowed for players\"); return;\r\n                }\r\n                console.log(`Placing text token '${textToDisplay}' with size ${tokenSize} at ${((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))}:${((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))}`);\r\n                socket.emit(\"createToken\", {text: textToDisplay, x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)), y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)), size: tokenSize, status: \"\", layer: 50-tokenSize, dm: isDM ? confirm(\"Make this a DM token?\") : false});\r\n            }});\r\n            for (const tokenImage of tokenList) {\r\n                subMenu.push({\r\n                    text: tokenImage.substring(0, tokenImage.length - 4),\r\n                    callback: () => {\r\n                        const tokenSize = Number.parseFloat(prompt(\"Please enter the size of the token\") ?? \"\");\r\n                        if (isNaN(tokenSize)) { alert(\"That wasn't a valid size!\"); return; }\r\n                        if (isDM && (tokenSize > 49  || tokenSize <= 0)) { alert(\"The desired size is too large or invalid\"); return; }\r\n                        if (!isDM && (tokenSize > 6 || tokenSize <= 0)) { alert(\"That token size isn't allowed for players\"); return; }\r\n                        console.log(`Placing ${tokenImage} with size ${tokenSize} at ${((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))}:${((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))}`);\r\n                        socket.emit(\"createToken\", {\r\n                            x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)),\r\n                            y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)),\r\n                            image: tokenImage,\r\n                            size: tokenSize,\r\n                            status: \"\",\r\n                            layer: 50-tokenSize,\r\n                            dm: false,\r\n                            text: \"\"\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            if (isDM) {\r\n                for (const tokenImage of dmTokenList) {\r\n                    subMenu.push({\r\n                        text: tokenImage.substring(0, tokenImage.length - 4),\r\n                        callback: () => {\r\n                            const tokenSize = Number.parseFloat(prompt(\"Please enter the size of the token\") ?? \"\");\r\n                            if (isNaN(tokenSize)) { alert(\"That wasn't a valid size!\"); return; }\r\n                            if (isDM && (tokenSize > 49  || tokenSize <= 0)) { alert(\"The desired size is too large or invalid\"); return; }\r\n                            if (!isDM && (tokenSize > 6 || tokenSize <= 0)) { alert(\"That token size isn't allowed for players\"); return; }\r\n                            console.log(`Placing ${tokenImage} with size ${tokenSize} at ${((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))}:${((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))}`);\r\n                            socket.emit(\"createToken\", {\r\n                                x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)),\r\n                                y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)),\r\n                                image: tokenImage,\r\n                                size: tokenSize,\r\n                                status: \"\",\r\n                                layer: 50-tokenSize,\r\n                                dm: true,\r\n                                text: \"\"\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            displaySubMenu(e, subMenu);\r\n        }},\r\n        {text: \"Draw Shape\", hasSubMenu: true, callback: () => {\r\n            const subMenuOptions = [\r\n                {text: \"Draw Circle\", callback: () => {\r\n                    const radiusInput = promptNumber(\"Please enter the desired radius in feet for your circle(s)\");\r\n                    if (radiusInput === null || isNaN(radiusInput)) { return; }\r\n                    circleMarkers.radius = radiusInput / feetPerSquare;\r\n                    circleMarkers.x = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n                    circleMarkers.y = ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n                    socket.emit(\"addDrawing\", {shape: \"circle\", x: circleMarkers.x, y: circleMarkers.y, radius: circleMarkers.radius, trueColor: shapeColor, visible: isDM?confirm(\"Should the shape be visible?\"):true});\r\n                }},\r\n                {text: \"Draw Square\", callback: () => {\r\n                    squareMarkers.x = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n                    squareMarkers.y = ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n                    flag.isPlacingSquare = true;\r\n                    drawCanvas();\r\n                }},\r\n                {text: \"Draw Line\", callback: () => {\r\n                    lineMarkers.x = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n                    lineMarkers.y = ((e.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n                    flag.isPlacingLine = true;\r\n                    drawCanvas();\r\n                }}\r\n            ];\r\n            displaySubMenu(e, subMenuOptions);\r\n        }}\r\n    ]\r\n    const DMoptions = [\r\n        {text: \"Place hidden Token\", hasSubMenu: true, callback: () => {\r\n            const subMenu = [\r\n                {text: \"Text token\", callback: () => {\r\n                    const textToDisplay = prompt(\"Enter the text to display on the text token:\") ?? '';\r\n                    const tokenSize = Number.parseFloat(prompt(\"Please enter the size of the token\") ?? \"\");\r\n                    if (isNaN(tokenSize)) { alert(\"That wasn't a valid size!\"); return;  }\r\n                    if (isDM && (tokenSize > 49  || tokenSize <= 0)) { alert(\"The desired size is too large or invalid\"); return; }\r\n                    console.log(`Placing hidden text token ${textToDisplay} with size ${tokenSize} at ${((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20))}:${((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20))}`);\r\n                    socket.emit(\"createToken\", {text: textToDisplay, x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)), y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)), size: tokenSize, status: \"\", layer: 50-tokenSize, dm: confirm(\"Make this a DM token?\"), hidden: true});\r\n                }}\r\n            ];\r\n            for (const tokenImage of mapData.tokenList) {\r\n                subMenu.push({\r\n                    text: tokenImage.substring(0, tokenImage.length - 4),\r\n                    callback: () => {\r\n                        const tokenSize = promptNumber(\"Please enter the size of the token\");\r\n                        if (tokenSize === null || isNaN(tokenSize)) { alert(\"That wasn't a valid size!\"); return; }\r\n                        if (tokenSize > 49 && tokenSize <= 0) { alert(\"The desired size is too large or invalid!\"); return; }\r\n                        console.log(\"Placing hidden \" + tokenImage + \" with size \" + tokenSize + \" at \" + ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)).toString() + \":\" + ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)).toString());\r\n                        socket.emit(\"createToken\", {\r\n                            x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)),\r\n                            y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)),\r\n                            image: tokenImage,\r\n                            size: tokenSize,\r\n                            status: \"\",\r\n                            hidden: true,\r\n                            layer: 50-tokenSize,\r\n                            dm: true,\r\n                            text: \"\"\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            for (const tokenImage of mapData.dmTokenList) {\r\n                subMenu.push({\r\n                    text: tokenImage.substring(0, tokenImage.length - 4),\r\n                    callback: () => {\r\n                        const tokenSize = promptNumber(\"Please enter the size of the token\");\r\n                        if (tokenSize === null || isNaN(tokenSize)) { alert(\"That wasn't a valid size!\"); return; }\r\n                        if (tokenSize > 49 && tokenSize <= 0) { alert(\"The desired size is too large or invalid!\"); return; }\r\n                        console.log(\"Placing hidden \" + tokenImage + \" with size \" + tokenSize + \" at \" + ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)).toString() + \":\" + ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)).toString());\r\n                        socket.emit(\"createToken\", {\r\n                            x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)),\r\n                            y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)),\r\n                            image: tokenImage,\r\n                            size: tokenSize,\r\n                            status: \"\",\r\n                            hidden: true,\r\n                            layer: 50-tokenSize,\r\n                            dm: true,\r\n                            text: \"\"\r\n                        });\r\n                    }\r\n                })\r\n            }\r\n            displaySubMenu(e, subMenu);\r\n        }}\r\n    ]\r\n\r\n    if (selectedToken !== '0-0-0-0-0') {\r\n        listOptions.push({text: \"Measure Distance\", hasSubMenu: false, callback: () => {\r\n            updateSelectedTokenData();\r\n            const targetCenterPos = {\r\n                x: Math.floor(((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20) - mapData.offsetX) / gridSize.x),\r\n                y: Math.floor(((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20) - mapData.offsetY) / gridSize.y),\r\n            }\r\n            const tokenCenterPos = {\r\n                x: (selectedTokenData.x - mapData.offsetX) / gridSize.x,\r\n                y: (selectedTokenData.y - mapData.offsetY) / gridSize.y,\r\n            }\r\n            const tokenRadius = selectedTokenData.size/2 - 0.5;\r\n            const tokenMoveOrigin = {\r\n                x: Math.floor(Math.min(Math.max(targetCenterPos.x, tokenCenterPos.x-tokenRadius), tokenCenterPos.x+tokenRadius)),\r\n                y: Math.floor(Math.min(Math.max(targetCenterPos.y, tokenCenterPos.y-tokenRadius), tokenCenterPos.y+tokenRadius)),\r\n            }\r\n            const distance = {\r\n                x: Math.abs(targetCenterPos.x - tokenMoveOrigin.x),\r\n                y: Math.abs(targetCenterPos.y - tokenMoveOrigin.y),\r\n            }\r\n            switch (mapData.diagonalMovement) {\r\n                case '5-10':\r\n                    alert(`Distance: ${Math.max(distance.x, distance.y) + Math.floor(Math.min(distance.x, distance.y)/2)}`);\r\n                    break;\r\n\r\n                case 'taxi':\r\n                    alert(`Distance: ${distance.x + distance.y}`);\r\n                    break;\r\n            }\r\n        }});\r\n    }\r\n\r\n    if (flag.gridAlignMode) {\r\n        const pos = {\r\n            x: (e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20),\r\n            y: (e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20),\r\n        }\r\n        listOptions.unshift({text: \"Horizontal Aligner\", hasSubMenu: false, callback: () => {\r\n            const line = document.createElement('div');\r\n            line.className = \"position-absolute translate-middle-y start-0\";\r\n            line.style.top = `${pos.y}px`;\r\n            line.style.zIndex = '9998';\r\n            line.style.height = `${GridLineWidth}px`;\r\n            line.style.width = `${mapPreload.width}px`;\r\n            line.style.backgroundColor = 'magenta';\r\n            const handle = document.createElement('div');\r\n            handle.style.height = `${GridLineWidth*10}px`;\r\n            handle.style.width = `${GridLineWidth*20}px`;\r\n            handle.className = \"position-absolute translate-middle-y border rounded\";\r\n            handle.style.backgroundColor = 'violet';\r\n            handle.style.zIndex = '9999';\r\n            handle.addEventListener('contextmenu', (e) => {\r\n                e.preventDefault();\r\n                displayMenu(e, [{\r\n                    text: 'Delete',\r\n                    hasSubMenu: false,\r\n                    callback: () => {\r\n                        $UI.hAlignHandles.removeChild(line);\r\n                    }\r\n                }])\r\n            })\r\n            line.appendChild(handle);\r\n            $UI.hAlignHandles.appendChild(line);\r\n            draggableElement(line, true);\r\n        }}, {text: \"Vertical Aligner\", hasSubMenu: false, callback: () => {\r\n            const line = document.createElement('div');\r\n            line.className = \"position-absolute translate-middle-x top-0\";\r\n            line.style.left = `${pos.x}px`;\r\n            line.style.zIndex = '9998';\r\n            line.style.width = `${GridLineWidth}px`;\r\n            line.style.height = `${mapPreload.height}px`;\r\n            line.style.backgroundColor = 'magenta';\r\n            const handle = document.createElement('div');\r\n            handle.style.height = `${GridLineWidth*20}px`;\r\n            handle.style.width = `${GridLineWidth*10}px`;\r\n            handle.className = \"position-absolute translate-middle-x border rounded\";\r\n            handle.style.backgroundColor = 'violet';\r\n            handle.style.zIndex = '9999';\r\n            handle.addEventListener('contextmenu', (e) => {\r\n                e.preventDefault();\r\n                displayMenu(e, [{\r\n                    text: 'Delete',\r\n                    hasSubMenu: false,\r\n                    callback: () => {\r\n                        $UI.vAlignHandles.removeChild(line);\r\n                    }\r\n                }])\r\n            })\r\n            line.appendChild(handle);\r\n            $UI.vAlignHandles.appendChild(line);\r\n            draggableElement(line, true);\r\n        }});\r\n    }\r\n\r\n    if (mapData.blockerType === 0) {\r\n        DMoptions.push({text: mapData.antiBlockerOn?\"Place Anti Blocker\":\"Place Blocker\", hasSubMenu: false, callback: () => {\r\n            blockerMarkers.x = (e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20);\r\n            blockerMarkers.y = (e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20);\r\n            flag.isPlacingBlocker = true;\r\n            drawCanvas();\r\n        }});\r\n    }\r\n    \r\n    if (mapData.blockerType === 1) {\r\n        DMoptions.push({\r\n            text: mapData.antiBlockerOn ? \"Create Anti Blocker\" : \"Create Blocker\",\r\n            hasSubMenu: false,\r\n            callback: () => {\r\n                socket.emit(\"addPolyBlocker\", {x: ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20)), y: ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20)), offset: gridSize});    \r\n            }\r\n        });\r\n    }\r\n\r\n    if (isDM) {\r\n        for (const option of DMoptions) {\r\n            listOptions.push(option);\r\n        }\r\n    }\r\n    displayMenu(e, listOptions);\r\n}\r\n\r\nwindow.onclick = function(event) {\r\n    if (event.target === null) {\r\n        return;\r\n    }\r\n    const ancestry = getAncestry(event.target as HTMLElement);\r\n    let shouldCloseMenus = true;\r\n    for (const element of ancestry) {\r\n        try {\r\n            if (element.classList.contains(\"custom-menu\")) {\r\n                shouldCloseMenus = false;\r\n            }\r\n        } catch {\r\n            if (element.className.includes(\"custom-menu\")) {\r\n                shouldCloseMenus = false;\r\n            }\r\n        }\r\n    }\r\n    if (shouldCloseMenus) { \r\n        closeMenu();\r\n        closeSubMenu();\r\n    }\r\n}\r\n\r\n$UI.mapImage.addEventListener(\"dragover\", (e) => {\r\n    e.preventDefault();\r\n});\r\n\r\n$UI.mapImage.addEventListener(\"dragend\", (e) => {\r\n    e.preventDefault();\r\n})\r\n\r\nwindow.ondrop = (e) => {\r\n    e.preventDefault();\r\n    if (flag.isDraggingBlocker) {\r\n        draggedBlocker.x = ((e.pageX+$UI.viewport.scrollLeft)/(1+extraZoom/20));\r\n        draggedBlocker.y = ((e.pageY+$UI.viewport.scrollTop)/(1+extraZoom/20));\r\n    }\r\n}\r\n//#endregion\r\n\r\n//#region Context Menu and Submenu\r\n    function displayMenu(event:MouseEvent, listData:ContextMenuOption[]) {\r\n        closeMenu();\r\n        closeSubMenu();\r\n        $UI.customMenu.innerHTML = \"\";\r\n        if (listData.length > 0) {\r\n            let tmpHeight = listData.length * 4;\r\n            if (tmpHeight > 28) {\r\n                tmpHeight = 28;\r\n                $UI.customMenu.style.overflowY = \"scroll\";\r\n            } else {\r\n                $UI.customMenu.style.overflowY = \"hidden\";\r\n            }\r\n            $UI.customMenu.style.display = \"block\";\r\n            \r\n            const posx = (event.pageX +$UI.viewport.scrollLeft)/(1+extraZoom/20);\r\n            const posy = (event.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20);\r\n            $UI.customMenu.style.transform = \"scale(\"+1/(1+extraZoom/20)+\")\";\r\n            $UI.customMenu.style.transformOrigin = \"top left\";\r\n            $UI.customMenu.style.top = posy + \"px\";\r\n            $UI.customMenu.style.left = posx + \"px\";\r\n            $UI.customMenu.style.height = tmpHeight + \"vh\";\r\n            \r\n            for (const menuOption of listData) {\r\n                const listItem = document.createElement('li');\r\n                listItem.innerText = menuOption.text;\r\n                listItem.style.userSelect = \"none\";\r\n                listItem.className = \"custom-menu-element\";\r\n                listItem.onclick = () => {\r\n                    menuOption.callback();\r\n                    if (menuOption.hasSubMenu != true) {\r\n                        closeMenu();\r\n                        closeSubMenu();\r\n                    }\r\n                }\r\n                $UI.customMenu.appendChild(listItem);\r\n            }\r\n            if (event.pageX + $UI.customMenu.offsetWidth >= window.innerWidth + window.pageXOffset - $UI.sideMenu.offsetWidth) {\r\n                $UI.customMenu.style.left = ((window.innerWidth +$UI.viewport.scrollLeft - $UI.customMenu.offsetWidth - $UI.sideMenu.offsetWidth - 5)/(1+extraZoom/20)).toString()+\"px\";\r\n            }\r\n            if (event.pageY + $UI.customMenu.offsetHeight > window.innerHeight + window.pageYOffset) {\r\n                $UI.customMenu.style.top = ((window.innerHeight +$UI.viewport.scrollTop - $UI.customMenu.offsetHeight - 4)/(1+extraZoom/20)).toString()+\"px\";\r\n            }\r\n        }\r\n    }\r\n    \r\n    function closeMenu() {\r\n $UI.customMenu.style.display = \"none\"; \r\n}\r\n\r\n    function displaySubMenu(event:MouseEvent, listData:SubContextMenuOption[]) {\r\n        $UI.customSubMenu.innerHTML = \"\";\r\n        if (listData.length > 0) {\r\n            let tmpHeight = listData.length * 4;\r\n            if (tmpHeight > 60) {\r\n                tmpHeight = 60;\r\n                $UI.customSubMenu.style.overflowY = \"scroll\";\r\n            } else {\r\n                $UI.customSubMenu.style.overflowY = \"hidden\";\r\n            }\r\n            $UI.customSubMenu.style.display = \"block\";\r\n            $UI.customSubMenu.style.transform = \"scale(\"+1/(1+extraZoom/20)+\")\";\r\n            $UI.customSubMenu.style.transformOrigin = \"top left\";\r\n            $UI.customSubMenu.style.height = tmpHeight + \"vh\";\r\n            $UI.customSubMenu.style.top = ((event.pageY +$UI.viewport.scrollTop)/(1+extraZoom/20)).toString() + \"px\";\r\n            $UI.customSubMenu.style.left = ($UI.customMenu.offsetLeft + $UI.customSubMenu.offsetWidth/(1+extraZoom/20) + 1/(1+extraZoom/20)).toString()+\"px\";\r\n            for (const subMenuOption of listData) {\r\n                const listItem = document.createElement('li');\r\n                listItem.innerText = subMenuOption.text;\r\n                listItem.style.userSelect = \"none\";\r\n                listItem.className = \"custom-menu-element\";\r\n                listItem.onclick = () => {\r\n                    subMenuOption.callback();\r\n                    closeMenu();\r\n                    closeSubMenu();\r\n                }\r\n                $UI.customSubMenu.appendChild(listItem);\r\n            }\r\n\r\n            if (event.pageY + $UI.customSubMenu.offsetHeight > window.innerHeight + window.pageYOffset) {\r\n                $UI.customSubMenu.style.top = ((window.innerHeight +$UI.viewport.scrollTop - $UI.customSubMenu.offsetHeight - 4)/(1+extraZoom/20)).toString()+\"px\";\r\n            }\r\n            \r\n            if (event.pageX + $UI.customMenu.offsetWidth + $UI.customSubMenu.offsetWidth >= window.innerWidth + window.pageXOffset - $UI.sideMenu.offsetWidth) {\r\n                $UI.customSubMenu.style.left = ($UI.customMenu.offsetLeft - $UI.customSubMenu.offsetWidth/(1+extraZoom/20) - 1/(1+extraZoom/20)).toString()+\"px\";\r\n            }\r\n        }\r\n    }\r\n\r\n    function closeSubMenu() {\r\n $UI.customSubMenu.style.display = \"none\"; \r\n}\r\n//#endregion\r\n\r\n//#region Low level functions\r\nfunction promptNumber(text:string, old?:number) {\r\n    const input = prompt(text, old?.toString());\r\n    if (input === null) {\r\n        console.log(\"Cancelled input!\");\r\n        return null;\r\n    }\r\n    if (input === '') {\r\n        console.log(\"Received invalid number!\");\r\n        return NaN;\r\n    }\r\n    return Number.parseFloat(input);\r\n}\r\n\r\nfunction promptInteger(text:string, old?:number) {\r\n    const input = prompt(text, old?.toString());\r\n    if (input === null) {\r\n        console.log(\"Cancelled input!\");\r\n        return null;\r\n    }\r\n    if (input === '') {\r\n        console.log(\"Received invalid int!\");\r\n        return NaN;\r\n    }\r\n    return parseInt(input);\r\n}\r\n\r\nfunction getChildren(element:HTMLElement) {\r\n    const children = new Array<HTMLElement>();\r\n    for (const child of element.children) {\r\n        children.push((child as HTMLElement));\r\n    }\r\n    return children;\r\n}\r\n\r\nfunction getAncestry(el:HTMLElement) {\r\n    const results = new Array<HTMLElement>();\r\n    let current = el;\r\n    do {\r\n        results.push(current);\r\n        if (current.parentElement === null) { return results; }\r\n        current = current.parentElement;\r\n    } while (current !== document.body);\r\n    return results;\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Cookies\r\nfunction setCookie(cname:string, cvalue:string) {\r\n    const d = new Date();\r\n    d.setTime(d.getTime() + (365 * 24 * 60 * 60 * 1000));\r\n    const expires = \"expires=\" + d.toUTCString();\r\n    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\r\n}\r\n\r\nfunction getCookie(cname:string) {\r\n    for(let c of document.cookie.split(';')) {\r\n        c = c.trim()\r\n        if (c.startsWith(cname))\r\n            return c.substring(cname.length+1, c.length);\r\n    }\r\n    return \"\";\r\n}\r\n//#endregion\r\n\r\n//#region Side menu stuff\r\nfunction updateButtonColors() {\r\n    $UI.toggleGrid.style.backgroundColor = flag.gridAlignMode ? (gridActive ? \"#ffa5ff\" : \"#00a5ff\") : (gridActive ? \"#ffa500\" : \"\");\r\n    $UI.toggleSnap.style.backgroundColor = gridSnap ? \"#ffa500\" : \"\";\r\n    updateColorPreview();\r\n    if (isDM) {\r\n        $UI.togglePlayerMode.style.backgroundColor = flag.playerMode ? \"#ffa500\" : \"\";\r\n        $UI.toggleSettings.style.backgroundColor = displayMapSettings ? \"#ffa500\" : \"\";\r\n        $UI.toggleBlockerEditing.style.backgroundColor = flag.blockerEditMode ? \"#ffa500\" : \"\";\r\n        $UI.quickPolyButton.style.backgroundColor = flag.quickPolyBlockerMode ? \"#ffa500\" : \"\";\r\n    }\r\n}\r\n//#endregion Side menu stuff"],
  "mappings": "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",
  "names": ["PACKET_TYPES", "PACKET_TYPES_REVERSE", "key", "ERROR_PACKET", "withNativeBlob", "withNativeArrayBuffer", "isView", "obj", "encodePacket", "type", "data", "supportsBinary", "callback", "encodeBlobAsBase64", "PACKET_TYPES", "fileReader", "content", "toArray", "TEXT_ENCODER", "encodePacketToBinary", "packet", "encoded", "chars", "lookup", "i", "decode", "base64", "bufferLength", "len", "i", "p", "encoded1", "encoded2", "encoded3", "encoded4", "arraybuffer", "bytes", "lookup", "withNativeArrayBuffer", "decodePacket", "encodedPacket", "binaryType", "mapBinary", "type", "decodeBase64Packet", "PACKET_TYPES_REVERSE", "ERROR_PACKET", "data", "decoded", "decode", "SEPARATOR", "encodePayload", "packets", "callback", "length", "encodedPackets", "count", "packet", "i", "encodePacket", "encodedPacket", "decodePayload", "encodedPayload", "binaryType", "decodedPacket", "decodePacket", "createPacketEncoderStream", "controller", "encodePacketToBinary", "payloadLength", "header", "view", "TEXT_DECODER", "totalLength", "chunks", "acc", "chunk", "concatChunks", "size", "buffer", "j", "createPacketDecoderStream", "maxPayload", "state", "expectedLength", "isBinary", "headerArray", "n", "ERROR_PACKET", "data", "protocol", "Emitter", "obj", "mixin", "key", "event", "fn", "on", "callbacks", "cb", "i", "args", "len", "globalThisShim", "pick", "obj", "attr", "acc", "k", "NATIVE_SET_TIMEOUT", "globalThisShim", "NATIVE_CLEAR_TIMEOUT", "installTimerFunctions", "opts", "BASE64_OVERHEAD", "byteLength", "utf8Length", "str", "c", "length", "i", "l", "encode", "obj", "str", "i", "decode", "qs", "qry", "pairs", "l", "pair", "TransportError", "reason", "description", "context", "Transport", "Emitter", "opts", "installTimerFunctions", "packets", "data", "packet", "decodePacket", "details", "onPause", "schema", "query", "hostname", "encodedQuery", "encode", "alphabet", "length", "map", "seed", "i", "prev", "encode", "num", "encoded", "yeast", "now", "encode", "prev", "seed", "i", "length", "map", "alphabet", "value", "hasCORS", "XHR", "opts", "xdomain", "hasCORS", "globalThisShim", "empty", "hasXHR2", "XHR", "Polling", "Transport", "opts", "isSSL", "port", "forceBase64", "onPause", "pause", "total", "data", "callback", "packet", "decodePayload", "close", "packets", "encodePayload", "schema", "query", "yeast", "Request", "fn", "req", "xhrStatus", "context", "_Request", "Emitter", "uri", "installTimerFunctions", "_a", "pick", "xhr", "i", "e", "err", "fromError", "unloadHandler", "terminationEvent", "globalThisShim", "nextTick", "cb", "setTimeoutFn", "WebSocket", "globalThisShim", "usingBrowserWebSocket", "defaultBinaryType", "isReactNative", "WS", "Transport", "opts", "uri", "protocols", "pick", "usingBrowserWebSocket", "WebSocket", "err", "closeEvent", "ev", "e", "packets", "i", "packet", "lastPacket", "encodePacket", "data", "nextTick", "schema", "query", "yeast", "WT", "Transport", "err", "stream", "decoderStream", "createPacketDecoderStream", "reader", "encoderStream", "createPacketEncoderStream", "read", "done", "value", "packet", "packets", "i", "lastPacket", "nextTick", "_a", "transports", "WS", "WT", "Polling", "re", "parts", "parse", "str", "src", "b", "e", "m", "uri", "i", "pathNames", "queryKey", "obj", "path", "regx", "names", "query", "data", "$0", "$1", "$2", "Socket", "_Socket", "Emitter", "uri", "opts", "defaultBinaryType", "parse", "installTimerFunctions", "decode", "name", "query", "protocol", "transports", "transport", "reason", "failed", "onTransportOpen", "msg", "cleanup", "err", "freezeTransport", "onerror", "error", "onTransportClose", "onclose", "onupgrade", "to", "i", "l", "packet", "data", "packets", "payloadSize", "byteLength", "options", "fn", "type", "close", "cleanupAndClose", "waitForUpgrade", "description", "upgrades", "filteredUpgrades", "j", "protocol", "Socket", "url", "uri", "path", "loc", "obj", "parse", "host", "esm_exports", "__export", "Decoder", "Encoder", "PacketType", "protocol", "withNativeArrayBuffer", "isView", "obj", "toString", "withNativeBlob", "withNativeFile", "isBinary", "hasBinary", "toJSON", "i", "l", "key", "deconstructPacket", "packet", "buffers", "packetData", "pack", "_deconstructPacket", "data", "isBinary", "placeholder", "newData", "i", "key", "reconstructPacket", "_reconstructPacket", "RESERVED_EVENTS", "protocol", "PacketType", "Encoder", "replacer", "obj", "hasBinary", "str", "deconstruction", "deconstructPacket", "pack", "buffers", "isObject", "value", "Decoder", "_Decoder", "Emitter", "reviver", "packet", "isBinaryEvent", "BinaryReconstructor", "isBinary", "i", "p", "start", "buf", "next", "c", "payload", "type", "binData", "reconstructPacket", "on", "obj", "ev", "fn", "RESERVED_EVENTS", "Socket", "Emitter", "io", "nsp", "opts", "on", "args", "ev", "packet", "PacketType", "id", "ack", "isTransportWritable", "_a", "timeout", "timer", "i", "withErr", "resolve", "reject", "arg1", "arg2", "err", "responseArgs", "force", "data", "reason", "description", "listeners", "listener", "self", "sent", "pid", "subDestroy", "compress", "Backoff", "opts", "ms", "rand", "deviation", "min", "max", "jitter", "Manager", "Emitter", "uri", "opts", "_a", "installTimerFunctions", "Backoff", "_parser", "esm_exports", "v", "fn", "Socket", "socket", "self", "openSubDestroy", "on", "onError", "err", "errorSub", "timeout", "timer", "data", "e", "packet", "nextTick", "nsp", "nsps", "encodedPackets", "i", "subDestroy", "reason", "description", "delay", "attempt", "cache", "lookup", "uri", "opts", "parsed", "url", "source", "id", "path", "sameNamespace", "newConnection", "io", "Manager", "Socket", "socket", "lookup", "starting", "gridActive", "gridSnap", "sideMenuExpanded", "blockerOutlineColor", "shapeWidth", "GridLineWidth", "feetPerSquare", "offsetX", "offsetY", "GridColor", "shapeColor", "$UI", "elName", "element", "gridCanvas", "antiBlockerContext", "mapData", "gridSize", "blockerDragOffset", "shapeDragOffset", "blockerMarkers", "circleMarkers", "squareMarkers", "lineMarkers", "thickLineMarkers", "coneMarkers", "isDM", "shapeColorCookie", "getCookie", "setCookie", "flag", "draggedBlocker", "oldMousePos", "oldScrollPos", "movingShapeId", "selectedToken", "selectedBlocker", "selectedShapeId", "selectedTokenData", "oldDataString", "oldParsedData", "baseTokenIndex", "shapeDragStartAngle", "polyDragOffset", "newPolyBlockerVerts", "mapPreload", "updateButtonColors", "Setup", "elementsToRemove", "i", "SyncSideMenu", "setColor", "dataString", "data", "pingCircle", "map", "tmpOption", "playerImage", "dmTokenImage", "mapSource", "drawCanvas", "skipMapRedraw", "returnToken", "id", "draggableElements", "draggableElement", "followMouse", "pickupElement", "dropElement", "moveElement", "checkBlocker", "followCondition", "ignoreElement", "zoomCompensation", "offset", "doFollow", "e", "getAncestry", "CheckAntiBlockerPixel", "closeMenu", "closeSubMenu", "extraZoom", "draggingElement", "previousScrollHeight", "previousScrollTop", "vLinePos", "getChildren", "a", "b", "hLinePos", "vLineDistances", "p", "hLineDistances", "xMean", "c", "yMean", "squares", "mapName", "skipMap", "el", "drawGrid", "drawAntiBlocker", "drawBlockers", "drawPolyBlockers", "drawTokens", "drawShapes", "updateTracker", "currentShape", "drawCircle", "drawSquare", "draw90Cone", "drawCone", "draw5Line", "drawVertexLine", "updateHighlights", "updateHighlightedShape", "shape", "vertexLine", "point", "hitbox", "handleContainer", "handle", "displayMenu", "contextMenuList", "vertX", "vertY", "previousPoint", "originX", "originY", "width", "height", "shapeGroupString", "group", "trueRadius", "circle", "currentToken", "t", "newRange", "promptNumber", "square", "linkedToken", "lineOrigin", "topOriginCorner", "topTargetCorner", "bottomOriginCorner", "bottomTargetCorner", "line5ft", "angle", "centerY", "centerX", "destX1", "destY1", "destX2", "destY2", "cone", "extendedRange", "cone90", "currentPolyBlocker", "newPolygon", "v", "vert", "editHandleContainer", "editHandle", "moveX", "moveY", "menuOptions", "currentBlocker", "tmpBlocker", "extraBlocker", "newX", "newY", "updateHighlightedBlocker", "poly", "blocker", "polyBlocker", "x", "y", "LoadTokenData", "token", "force", "CheckTokenPermission", "DetailsToggleButtonsUpdate", "notesTargetToken", "drawToken", "refreshToken", "oldContainer", "tokenContainer", "imageElement", "textHolder", "hiddenImage", "concentratingIcon", "displaySubMenu", "radiusInput", "rangeInput", "subMenuOptions", "tokenSize", "newLayer", "promptInteger", "newText", "subMenu", "image", "tmpToken", "zoomAdjustedPos", "tokenCenter", "tempx", "tempy", "CheckAntiBlockerPixelPosition", "tX", "tY", "updateHighlightedToken", "previousInitiativeTrackerScrollPosition", "createTracker", "isDraggingTracker", "trackerData", "initiativeItem", "damage", "minHP", "maxHP", "h", "updateHighlightedTracker", "currentInitTracker", "concentrating", "hide", "DrawNewPolyMarkers", "displayMapSettings", "displayColorPicker", "updateColorPreview", "updateColor", "componentToHex", "isAlpha", "hex", "rgbaToHex", "r", "g", "hexToRgba", "result", "hexValue", "components", "updateSelectedTokenData", "noteData", "newInit", "newAC", "newGroupId", "activateMousedown", "j", "movingShapeData", "s", "placeBulkOrigin", "bulkSettings", "origin", "tokenInit", "f", "tokenPos", "shapeIsVisible", "destX", "destY", "displayContextMenu", "listOptions", "tokenList", "dmTokenList", "textToDisplay", "tokenImage", "DMoptions", "targetCenterPos", "tokenCenterPos", "tokenRadius", "tokenMoveOrigin", "distance", "pos", "line", "option", "event", "ancestry", "shouldCloseMenus", "listData", "tmpHeight", "posx", "posy", "menuOption", "listItem", "subMenuOption", "text", "old", "input", "children", "child", "results", "current", "cname", "cvalue", "d", "expires"]
}
